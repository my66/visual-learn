<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第6题：几何解法逐步演示 (左右布局版)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- MathJax -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        .highlight-line {
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
            animation: dash 1.5s linear forwards;
        }
        @keyframes dash {
            to { stroke-dashoffset: 0; }
        }
        /* Custom scrollbar for left panel */
        .custom-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        .custom-scroll::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 font-sans h-screen overflow-hidden flex flex-row">

    <!-- Left Panel: Operation & Explanation (Fixed Width / Resizable logic simulated by flex) -->
    <aside class="w-full lg:w-5/12 xl:w-1/3 bg-white shadow-2xl z-10 flex flex-col border-r border-gray-200">
        
        <!-- Header Section -->
        <div class="bg-blue-600 text-white p-5 flex-shrink-0 shadow-md">
            <div class="flex justify-between items-start">
                <div>
                    <h1 class="text-xl font-bold tracking-tight">几何习题精讲 · 第6题</h1>
                    <p class="text-blue-100 text-sm mt-1">构造全等与30°角直角三角形</p>
                </div>
                <span class="bg-blue-500 text-xs px-2 py-1 rounded border border-blue-400">初二几何</span>
            </div>
        </div>

        <!-- Scrollable Content Area -->
        <div class="flex-grow overflow-y-auto custom-scroll p-6 space-y-6">
            
            <!-- Problem Description -->
            <div class="bg-blue-50 p-4 rounded-lg border border-blue-100 text-sm leading-relaxed text-gray-700">
                <span class="font-bold text-blue-800 block mb-1">题目：</span>
                如图，$OC$ 平分 $\angle AOB$，且 $\angle AOB=60^\circ$。点 $P$ 为 $OC$ 上一点，已知 $PM \perp OA$ 于 $M$，且 $PD \parallel OA$ 交 $OB$ 于 $D$。若 $OM=3$，求 $PD$ 的长。
            </div>

            <!-- Dynamic Explanation Card -->
            <div class="space-y-4">
                <div class="flex items-center gap-2">
                    <div class="w-1 h-6 bg-blue-600 rounded-full"></div>
                    <h2 id="step-title" class="text-lg font-bold text-gray-900">准备开始</h2>
                </div>

                <div id="step-content" class="text-gray-600 text-base leading-7">
                    <p>点击下方“下一步”按钮开始演示。</p>
                </div>

                <!-- Math Highlight Box -->
                <div id="math-box" class="hidden mt-4 bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-r-lg shadow-sm">
                    <p class="text-xs font-bold text-yellow-600 uppercase tracking-wider mb-1">关键结论 / Key Conclusion</p>
                    <div id="math-content" class="text-xl font-serif text-gray-800"></div>
                </div>
            </div>
        
        </div>

        <!-- Bottom Controls (Fixed) -->
        <div class="p-5 border-t border-gray-100 bg-gray-50">
            <!-- Progress -->
            <div class="flex justify-between text-xs text-gray-500 mb-2 font-medium">
                <span id="step-indicator">步骤 0 / 5</span>
                <span>进度</span>
            </div>
            <div class="w-full h-1.5 bg-gray-200 rounded-full mb-4 overflow-hidden">
                <div id="progress-bar" class="h-full bg-blue-600 transition-all duration-500 ease-out" style="width: 0%"></div>
            </div>

            <!-- Buttons -->
            <div class="flex gap-3">
                <button onclick="prevStep()" id="btn-prev" class="flex-1 py-3 px-4 rounded-lg border border-gray-300 text-gray-600 font-medium hover:bg-white hover:shadow-sm disabled:opacity-50 disabled:cursor-not-allowed transition active:scale-[0.98]">
                    上一歩
                </button>
                <button onclick="nextStep()" id="btn-next" class="flex-[2] py-3 px-4 rounded-lg bg-blue-600 text-white font-bold shadow-lg shadow-blue-200 hover:bg-blue-700 hover:shadow-xl disabled:opacity-50 transition transform active:scale-[0.98] flex items-center justify-center gap-2">
                    下一步 
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                </button>
            </div>
        </div>
    </aside>

    <!-- Right Panel: Visualization -->
    <main class="flex-1 bg-slate-100 relative flex items-center justify-center p-8">
        <!-- Decoration -->
        <div class="absolute inset-0 opacity-5 pointer-events-none" style="background-image: radial-gradient(#64748b 1px, transparent 1px); background-size: 24px 24px;"></div>

        <!-- Canvas Container -->
        <div class="bg-white rounded-2xl shadow-xl border border-gray-200 p-2 w-full max-w-4xl aspect-[5/4] max-h-full flex items-center justify-center relative overflow-hidden">
             <!-- Label for context -->
             <div class="absolute top-4 right-4 bg-gray-50 text-gray-400 text-xs px-2 py-1 rounded border border-gray-100">
                Visualization Canvas
             </div>

             <svg id="geometry-canvas" viewBox="0 0 500 400" class="w-full h-full">
                <!-- Definitions -->
                <defs>
                    <marker id="arrow" markerWidth="8" markerHeight="8" refX="7" refY="3" orient="auto" markerUnits="strokeWidth">
                        <path d="M0,0 L0,6 L9,3 z" fill="#475569" />
                    </marker>
                    <!-- Shadow filter for lines -->
                    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
                        <feDropShadow dx="1" dy="1" stdDeviation="1" flood-color="#000" flood-opacity="0.15"/>
                    </filter>
                </defs>

                <!-- Static Background Group -->
                <g id="static-elements">
                    <!-- Base Lines (OA, OB, OC) -->
                    <!-- O is at (50, 350) -->
                    <line x1="50" y1="350" x2="450" y2="350" stroke="#94a3b8" stroke-width="2" marker-end="url(#arrow)" />
                    <text x="440" y="375" class="text-sm font-bold fill-slate-500 font-serif">A</text>
                    <text x="30" y="370" class="text-lg font-bold fill-slate-700 font-serif">O</text>

                    <!-- OB is at 60 degrees -->
                    <line x1="50" y1="350" x2="250" y2="4" stroke="#94a3b8" stroke-width="2" marker-end="url(#arrow)" />
                    <text x="230" y="30" class="text-sm font-bold fill-slate-500 font-serif">B</text>

                    <!-- OC is at 30 degrees (Angle Bisector) -->
                    <line x1="50" y1="350" x2="400" y2="148" stroke="#cbd5e1" stroke-width="1.5" stroke-dasharray="6,4" />
                    <text x="410" y="150" class="text-sm fill-slate-400 font-serif">C</text>
                </g>

                <!-- Dynamic Elements Group -->
                <g id="dynamic-elements"></g>
            </svg>
        </div>
    </main>

    <script>
        // --- Geometry Constants ---
        const pointO = { x: 50, y: 350 };
        const SCALE = 60; // 1 unit = 60 pixels
        
        // Coordinates Calculation
        const pointM = { x: pointO.x + 3 * SCALE, y: pointO.y }; 
        const PM_len = Math.sqrt(3) * SCALE;
        const pointP = { x: pointM.x, y: pointM.y - PM_len }; 
        const pointD = { x: pointO.x + 1 * SCALE, y: pointP.y }; 
        const pointN = {
            x: pointO.x + 3 * SCALE * Math.cos(Math.PI / 3),
            y: pointO.y - 3 * SCALE * Math.sin(Math.PI / 3)
        };

        // --- State Management ---
        let currentStep = 0;
        const totalSteps = 5;

        const steps = [
            {
                title: "0. 分析已知条件",
                content: `
                    <p class="mb-2">首先明确题目中的几何关系：</p>
                    <ul class="list-disc list-inside space-y-1 ml-1 marker:text-blue-500">
                        <li>$OC$ 是角平分线 $\\implies \\angle AOP = \\angle BOP = 30^\\circ$</li>
                        <li>已知底边 $OM = 3$</li>
                        <li>$PD \\parallel OA$ 是一条水平线</li>
                    </ul>
                    <p class="mt-4 text-sm text-gray-500">目标：求红色悬空线段 $PD$ 的长度。</p>
                `,
                math: "求: PD = ?",
                draw: () => {
                    drawBaseFig();
                }
            },
            {
                title: "1. 辅助线策略",
                content: `
                    <p><strong>思维突破口：</strong>点 $P$ 在角平分线上，且有一边垂直 ($PM \\perp OA$)。</p>
                    <p class="mt-2">根据“角平分线上的点到角两边距离相等”，我们可以作：</p>
                    <div class="bg-indigo-50 p-2 mt-2 rounded border border-indigo-100 text-indigo-800 font-medium text-center">
                        作 $PN \\perp OB$ 于点 $N$
                    </div>
                `,
                math: "辅助线: PN \\perp OB",
                draw: () => {
                    drawBaseFig();
                    drawAuxLine();
                }
            },
            {
                title: "2. 证明全等 (AAS)",
                content: `
                    <p>观察 $\\text{Rt}\\triangle OMP$ 和 $\\text{Rt}\\triangle ONP$：</p>
                    <ul class="list-disc list-inside space-y-1 ml-1 text-sm">
                        <li>$\\angle MOP = \\angle NOP = 30^\\circ$ (已知)</li>
                        <li>$OP = OP$ (公共边)</li>
                    </ul>
                    <p class="mt-2">$\\therefore \\triangle OMP \\cong \\triangle ONP$。</p>
                    <p class="mt-2 text-green-700 font-bold">重要结论：对应边相等，我们将 $OM$ 的长度转移到了 $OB$ 边上。</p>
                `,
                math: "ON = OM = 3",
                draw: () => {
                    drawBaseFig();
                    drawAuxLine();
                    highlightSegment(pointO, pointN, "#10b981", "ON=3");
                    highlightSegment(pointO, pointM, "#94a3b8", "OM=3");
                }
            },
            {
                title: "3. 发现等腰三角形",
                content: `
                    <p>接下来分析 $\\triangle ODP$ 的角度：</p>
                    <ul class="list-disc list-inside space-y-1 ml-1 text-sm">
                        <li>$OC$ 平分角 $\\implies \\angle DOP = 30^\\circ$</li>
                        <li>$PD \\parallel OA \\implies \\angle DPO = \\angle POA = 30^\\circ$ (内错角)</li>
                    </ul>
                    <p class="mt-2">因为底角相等，所以它是<strong>等腰三角形</strong>。</p>
                `,
                math: "OD = PD",
                draw: () => {
                    drawBaseFig();
                    drawAuxLine();
                    highlightSegment(pointO, pointD, "#3b82f6", "OD");
                    highlightSegment(pointP, pointD, "#3b82f6", "PD");
                }
            },
            {
                title: "4. 30-60-90 三角形性质",
                content: `
                    <p>最后看剩下的小直角三角形 $\\triangle PND$：</p>
                    <p class="mt-1 text-sm text-gray-600">$\\because PD \\parallel OA, \\therefore \\angle PDN = \\angle AOB = 60^\\circ$。</p>
                    <p class="mt-1 text-sm text-gray-600">$\\therefore \\angle DPN = 30^\\circ$。</p>
                    <p class="mt-3 font-medium text-orange-600">根据“30度所对直角边等于斜边一半”：</p>
                `,
                math: "DN = \\frac{1}{2}PD",
                draw: () => {
                    drawBaseFig();
                    drawAuxLine();
                    drawTriangleHighlight(pointP, pointN, pointD);
                }
            },
            {
                title: "5. 总结求解",
                content: `
                    <p>将线段 $ON$ 拆解：</p>
                    <p class="text-center font-mono my-2 text-lg">$ON = OD + DN$</p>
                    <p>代入我们之前得到的所有关系：</p>
                    <p class="text-center font-mono my-2">$3 = PD + \\frac{1}{2}PD$</p>
                    <p>解得：$3 = \\frac{3}{2}PD$。</p>
                `,
                math: "\\therefore PD = 2",
                draw: () => {
                    drawBaseFig();
                    drawAuxLine();
                    drawResult();
                }
            }
        ];

        // --- Drawing Logic ---

        const svgGroup = document.getElementById('dynamic-elements');

        function clearSvg() {
            svgGroup.innerHTML = '';
        }

        function createLine(p1, p2, color, width = 2, dash = "") {
            const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
            line.setAttribute("x1", p1.x); line.setAttribute("y1", p1.y);
            line.setAttribute("x2", p2.x); line.setAttribute("y2", p2.y);
            line.setAttribute("stroke", color);
            line.setAttribute("stroke-width", width);
            line.setAttribute("stroke-linecap", "round");
            if (dash) line.setAttribute("stroke-dasharray", dash);
            return line;
        }

        function createText(p, text, offset = {x:0, y:0}, color="#334155") {
            const t = document.createElementNS("http://www.w3.org/2000/svg", "text");
            t.setAttribute("x", p.x + offset.x);
            t.setAttribute("y", p.y + offset.y);
            t.setAttribute("fill", color);
            t.setAttribute("class", "text-sm font-bold font-serif select-none");
            t.textContent = text;
            return t;
        }

        function drawBaseFig() {
            clearSvg();
            // PD
            svgGroup.appendChild(createLine(pointP, pointD, "#ef4444", 3)); 
            // PM
            svgGroup.appendChild(createLine(pointP, pointM, "#64748b", 2)); 
            // OP
            svgGroup.appendChild(createLine(pointO, pointP, "#94a3b8", 1.5));
            // Points
            drawPoint(pointP, "P", {x:0, y:-12});
            drawPoint(pointM, "M", {x:0, y:20});
            drawPoint(pointD, "D", {x:-20, y:-5});
            
            // Right angle symbol at M
            drawRightAngle(pointM, 12, 0); 
        }

        function drawPoint(p, label, offset) {
            const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            circle.setAttribute("cx", p.x); circle.setAttribute("cy", p.y);
            circle.setAttribute("r", 4);
            circle.setAttribute("fill", "white");
            circle.setAttribute("stroke", "#475569");
            circle.setAttribute("stroke-width", "2");
            svgGroup.appendChild(circle);
            svgGroup.appendChild(createText(p, label, offset));
        }

        function drawRightAngle(p, size, rotation=0) {
            // Simple path for M (perp to horizontal OA)
            // M is on OA (horizontal). PM is vertical.
            const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
            // Draw box at top-left of M (since line comes from top)
            // M is (x, 350). P is above.
            const d = `M ${p.x} ${p.y-size} L ${p.x-size} ${p.y-size} L ${p.x-size} ${p.y}`;
            path.setAttribute("d", d);
            path.setAttribute("fill", "none");
            path.setAttribute("stroke", "#64748b");
            path.setAttribute("stroke-width", "1.5");
            svgGroup.appendChild(path);
        }

        function drawAuxLine() {
            // PN
            const line = createLine(pointP, pointN, "#8b5cf6", 2, "5,3");
            svgGroup.appendChild(line);
            drawPoint(pointN, "N", {x:-18, y:-5});
        }

        function highlightSegment(p1, p2, color, label) {
            const line = createLine(p1, p2, color, 4);
            line.setAttribute("class", "highlight-line");
            svgGroup.appendChild(line);
            
            // Midpoint label background
            const mid = { x: (p1.x + p2.x)/2, y: (p1.y + p2.y)/2 };
            
            // Text
            const t = createText(mid, label, {x:8, y:-8}, color);
            t.setAttribute("font-weight", "bold");
            svgGroup.appendChild(t);
        }

        function drawTriangleHighlight(p1, p2, p3) {
            const path = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
            path.setAttribute("points", `${p1.x},${p1.y} ${p2.x},${p2.y} ${p3.x},${p3.y}`);
            path.setAttribute("fill", "rgba(249, 115, 22, 0.2)");
            path.setAttribute("stroke", "#f97316");
            path.setAttribute("stroke-width", "2");
            svgGroup.appendChild(path);
            
            // Add DN label highlight
            const midDN = {x: (p2.x+p3.x)/2, y: (p2.y+p3.y)/2};
            svgGroup.appendChild(createText(midDN, "DN", {x:-25, y:15}, "#f97316"));
        }

        function drawResult() {
            highlightSegment(pointP, pointD, "#10b981", "PD = 2");
        }

        // --- Interaction ---

        function updateStep() {
            const s = steps[currentStep];
            
            document.getElementById('step-title').innerText = s.title;
            document.getElementById('step-content').innerHTML = s.content;
            document.getElementById('step-indicator').innerText = `步骤 ${currentStep} / ${totalSteps}`;
            
            const progress = (currentStep / totalSteps) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;

            const mathBox = document.getElementById('math-box');
            if (s.math) {
                mathBox.classList.remove('hidden');
                document.getElementById('math-content').innerText = `$$${s.math}$$`;
            } else {
                mathBox.classList.add('hidden');
            }

            if (window.MathJax && window.MathJax.typesetPromise) {
                MathJax.typesetPromise();
            }

            s.draw();

            document.getElementById('btn-prev').disabled = currentStep === 0;
            const btnNext = document.getElementById('btn-next');
            if (currentStep === totalSteps) {
                btnNext.innerHTML = '演示结束 <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>';
                btnNext.classList.replace('bg-blue-600', 'bg-green-600');
                btnNext.classList.replace('shadow-blue-200', 'shadow-green-200');
                btnNext.disabled = true;
            } else {
                btnNext.innerHTML = '下一步 <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/></svg>';
                btnNext.classList.replace('bg-green-600', 'bg-blue-600');
                btnNext.classList.replace('shadow-green-200', 'shadow-blue-200');
                btnNext.disabled = false;
            }
        }

        function nextStep() {
            if (currentStep < totalSteps) {
                currentStep++;
                updateStep();
            }
        }

        function prevStep() {
            if (currentStep > 0) {
                currentStep--;
                updateStep();
            }
        }

        updateStep();
    </script>
</body>
</html>