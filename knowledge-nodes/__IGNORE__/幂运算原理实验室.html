<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>幂运算原理实验室</title>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 React 和 ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- 引入 Babel 用于解析 JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* 自定义一些动画效果 */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-in {
            animation-duration: 0.5s;
            animation-fill-mode: both;
        }
        .fade-in {
            animation-name: fadeIn;
        }
        .slide-in-from-bottom {
            animation-name: slideUp;
        }
        .slide-in-from-top {
            animation-name: slideUp; /* 简化复用 */
        }
        .perspective-500 {
            perspective: 500px;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // --- 图标组件定义 (替代 lucide-react 库引用) ---
        const IconWrapper = ({ children, size = 24, className = "" }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {children}
            </svg>
        );

        const BoxIcon = (props) => (
            <IconWrapper {...props}>
                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                <line x1="12" y1="22.08" x2="12" y2="12"></line>
            </IconWrapper>
        );

        const SplitIcon = (props) => (
            <IconWrapper {...props}>
                <path d="M16 3h5v5"></path>
                <path d="M8 3H3v5"></path>
                <path d="M12 22v-8.3a4 4 0 0 0-1.172-2.872L3 3"></path>
                <path d="m15 9 6-6"></path>
            </IconWrapper>
        );

        const AlertTriangleIcon = (props) => (
            <IconWrapper {...props}>
                <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path>
                <line x1="12" y1="9" x2="12" y2="13"></line>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </IconWrapper>
        );

        const CalculatorIcon = (props) => (
            <IconWrapper {...props}>
                <rect x="4" y="2" width="16" height="20" rx="2"></rect>
                <line x1="8" y1="6" x2="16" y2="6"></line>
                <line x1="16" y1="14" x2="16" y2="14"></line>
                <line x1="16" y1="18" x2="16" y2="18"></line>
                <line x1="12" y1="14" x2="12" y2="14"></line>
                <line x1="12" y1="18" x2="12" y2="18"></line>
                <line x1="8" y1="14" x2="8" y2="14"></line>
                <line x1="8" y1="18" x2="8" y2="18"></line>
            </IconWrapper>
        );

        const RefreshCcwIcon = (props) => (
            <IconWrapper {...props}>
                <path d="M3 2v6h6"></path>
                <path d="M3 13a9 9 0 1 0 3-7.7L3 8"></path>
            </IconWrapper>
        );

        const ArrowRightIcon = (props) => (
            <IconWrapper {...props}>
                <line x1="5" y1="12" x2="19" y2="12"></line>
                <polyline points="12 5 19 12 12 19"></polyline>
            </IconWrapper>
        );

        // --- 主应用组件 ---

        const TabButton = ({ active, onClick, icon, label }) => (
            <button
                onClick={onClick}
                className={`flex-1 py-4 flex items-center justify-center gap-2 text-sm font-medium border-b-2 transition-colors
                ${active 
                    ? 'border-purple-600 text-purple-700 bg-purple-50/50' 
                    : 'border-transparent text-slate-500 hover:text-slate-700 hover:bg-slate-50'}`}
            >
                {icon}
                <span>{label}</span>
            </button>
        );

        // Tab 1: Decomposition (The Cell Division Metaphor)
        const DecompositionLab = () => {
            const [base, setBase] = useState(4); // 4, 8, 9
            const [exponent, setExponent] = useState(2);
            const [isDecomposed, setIsDecomposed] = useState(false);

            const baseOptions = [
                { value: 4, prime: 2, power: 2, color: 'bg-blue-500', subColor: 'bg-indigo-500' },
                { value: 8, prime: 2, power: 3, color: 'bg-blue-600', subColor: 'bg-indigo-500' },
                { value: 9, prime: 3, power: 2, color: 'bg-orange-500', subColor: 'bg-amber-500' },
            ];

            const currentBaseConfig = baseOptions.find(b => b.value === base);

            return (
                <div className="flex flex-col gap-8">
                    {/* Controls */}
                    <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200 flex flex-wrap gap-8 items-center justify-between">
                        <div className="flex gap-4 items-center">
                            <div className="space-y-1">
                                <label className="text-xs font-bold text-slate-400 uppercase">选择底数</label>
                                <div className="flex gap-2">
                                    {baseOptions.map(opt => (
                                        <button
                                            key={opt.value}
                                            onClick={() => { setBase(opt.value); setIsDecomposed(false); }}
                                            className={`w-10 h-10 rounded-lg font-bold text-lg transition-all ${
                                                base === opt.value ? 'bg-slate-800 text-white shadow-md scale-110' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'
                                            }`}
                                        >
                                            {opt.value}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            <div className="w-px h-12 bg-slate-200 mx-2"></div>

                            <div className="space-y-1">
                                <label className="text-xs font-bold text-slate-400 uppercase">指数 (n)</label>
                                <div className="flex items-center gap-3">
                                    <input 
                                        type="range" min="1" max="4" step="1"
                                        value={exponent}
                                        onChange={(e) => { setExponent(parseInt(e.target.value)); setIsDecomposed(false); }}
                                        className="w-32 accent-purple-600"
                                    />
                                    <span className="font-mono text-lg font-bold w-6">{exponent}</span>
                                </div>
                            </div>
                        </div>

                        <button
                            onClick={() => setIsDecomposed(!isDecomposed)}
                            className={`px-6 py-3 rounded-xl font-bold text-white shadow-lg transition-all flex items-center gap-2
                                ${isDecomposed ? 'bg-slate-500 hover:bg-slate-600' : 'bg-purple-600 hover:bg-purple-700 hover:scale-105'}
                            `}
                        >
                            {isDecomposed ? <><RefreshCcwIcon size={18}/> 复原</> : <><SplitIcon size={18}/> 拆解底数</>}
                        </button>
                    </div>

                    {/* Visual Stage */}
                    <div className="bg-slate-100 rounded-2xl p-8 min-h-[400px] flex flex-col items-center justify-center relative overflow-hidden border border-slate-200">
                        <div className="text-center mb-8 z-10">
                            <h3 className="text-2xl font-serif text-slate-700 mb-2">
                                {isDecomposed ? (
                                    <span className="animate-in fade-in slide-in-from-bottom">
                                        ({currentBaseConfig.prime}<sup>{currentBaseConfig.power}</sup>)<sup>{exponent}</sup> 
                                        {' = '} 
                                        <span className="text-purple-600 font-bold">
                                            {currentBaseConfig.prime}<sup>{currentBaseConfig.power * exponent}</sup>
                                        </span>
                                    </span>
                                ) : (
                                    <span>{base}<sup>{exponent}</sup></span>
                                )}
                            </h3>
                            <p className="text-sm text-slate-500">
                                {isDecomposed ? `每一个大方块分裂成了 ${currentBaseConfig.power} 个小方块` : `当前有 ${exponent} 个底数为 ${base} 的因子`}
                            </p>
                        </div>

                        {/* Blocks Container */}
                        <div className="flex gap-4 items-end flex-wrap justify-center content-center z-10 transition-all duration-500">
                            {Array.from({ length: exponent }).map((_, idx) => (
                                <div key={idx} className="relative group perspective-500">
                                    
                                    {/* The "Parent" Block */}
                                    <div 
                                        className={`
                                            w-24 h-24 rounded-xl shadow-xl flex items-center justify-center text-3xl font-bold text-white mb-2
                                            transition-all duration-700 cursor-pointer border-4 border-white/20
                                            ${currentBaseConfig.color}
                                            ${isDecomposed ? 'opacity-0 scale-150 absolute top-0 left-0 pointer-events-none' : 'opacity-100 scale-100'}
                                        `}
                                    >
                                        {base}
                                    </div>

                                    {/* The "Child" Blocks (Decomposed) */}
                                    <div 
                                        className={`
                                            grid gap-2 transition-all duration-700
                                            ${currentBaseConfig.power === 3 ? 'grid-cols-2' : 'grid-cols-1'} 
                                            ${isDecomposed ? 'opacity-100 scale-100' : 'opacity-0 scale-50 absolute top-0 left-0 pointer-events-none'}
                                        `}
                                        style={{
                                            gridTemplateColumns: currentBaseConfig.power >= 2 ? 'repeat(auto-fit, minmax(3rem, 1fr))' : '1fr',
                                            width: '6rem'
                                        }}
                                    >
                                        {Array.from({ length: currentBaseConfig.power }).map((_, childIdx) => (
                                            <div 
                                                key={childIdx}
                                                className={`
                                                    h-12 rounded-lg flex items-center justify-center text-lg font-bold text-white shadow-sm border border-white/20
                                                    ${currentBaseConfig.subColor}
                                                `}
                                            >
                                                {currentBaseConfig.prime}
                                            </div>
                                        ))}
                                    </div>

                                    {/* Brackets for grouping */}
                                    {isDecomposed && (
                                        <div className="absolute -bottom-6 left-0 right-0 text-center text-xs text-slate-400 font-mono animate-in fade-in delay-300">
                                            1组
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>

                        {isDecomposed && (
                            <div className="mt-12 bg-white/80 backdrop-blur p-4 rounded-xl border border-purple-100 text-purple-900 shadow-lg animate-in slide-in-from-bottom duration-500 max-w-lg">
                                <div className="font-bold mb-1 flex items-center gap-2">
                                    <SplitIcon size={16} /> 核心原理
                                </div>
                                <p className="text-sm leading-relaxed">
                                    指数 {exponent} 表示有 <span className="font-bold">{exponent}</span> 个大方块。
                                    拆解时，<span className="font-bold underline">每一个</span>大方块都变成了 {currentBaseConfig.power} 个小方块。
                                    <br/>
                                    所以总数 = <span className="font-mono bg-purple-100 px-1 rounded">{exponent} (组) × {currentBaseConfig.power} (个/组) = {exponent * currentBaseConfig.power}</span> 个。
                                    这就是为什么指数要相乘：<span className="font-serif italic">(a<sup>m</sup>)<sup>n</sup> = a<sup>mn</sup></span>。
                                </p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // Tab 2: Comparison (Why not simple multiplication?)
        const ComparisonLab = () => {
            const [exponent, setExponent] = useState(3);
            
            // Example: 4^x vs 2 * 2^x
            const valCorrect = Math.pow(4, exponent);
            const valWrong = 2 * Math.pow(2, exponent);
            
            // Scale for visualization height
            const maxVal = Math.pow(4, 4); 
            const scale = 200 / maxVal; 

            return (
                <div className="flex flex-col gap-6">
                    <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                        <h2 className="text-lg font-bold text-slate-800 mb-4">为什么 4<sup>x</sup> 不能拆成 2 · 2<sup>x</sup> ?</h2>
                        <div className="flex items-center gap-4 mb-8">
                            <label className="font-bold text-slate-500 text-sm">改变指数 x :</label>
                            <input 
                                type="range" min="1" max="4" step="1"
                                value={exponent}
                                onChange={(e) => setExponent(parseInt(e.target.value))}
                                className="flex-1 accent-red-500"
                            />
                            <span className="font-mono text-xl font-bold bg-slate-100 px-3 py-1 rounded">x = {exponent}</span>
                        </div>

                        <div className="flex flex-col md:flex-row gap-12 items-end justify-center h-[300px] border-b border-slate-300 pb-4 relative">
                            {/* Background Lines */}
                            <div className="absolute inset-0 flex flex-col justify-between pointer-events-none text-xs text-slate-300">
                                <span>Max</span>
                                <span>0</span>
                            </div>

                            {/* Wrong Bar */}
                            <div className="flex flex-col items-center gap-2 w-32 group">
                                <div className="text-red-500 font-bold text-lg mb-1 group-hover:scale-110 transition-transform">{valWrong}</div>
                                <div 
                                    className="w-full bg-red-100 border-2 border-red-400 rounded-t-lg transition-all duration-500 relative overflow-hidden"
                                    style={{ height: `${Math.max(valWrong * (300/maxVal), 20)}px` }}
                                >
                                    <div className="absolute inset-0 bg-red-200 opacity-50 w-full h-full"></div>
                                </div>
                                <div className="text-center">
                                    <div className="font-mono font-bold text-red-600">2 · 2<sup>{exponent}</sup></div>
                                    <div className="text-xs text-red-400 mt-1">简单的线性拆分</div>
                                    <div className="text-xs text-slate-400 mt-1">(错误想法)</div>
                                </div>
                            </div>

                            {/* Comparison Icon */}
                            <div className="text-slate-300 font-bold text-4xl mb-12">≠</div>

                            {/* Correct Bar */}
                            <div className="flex flex-col items-center gap-2 w-32 group">
                                <div className="text-blue-600 font-bold text-2xl mb-1 group-hover:scale-110 transition-transform">{valCorrect}</div>
                                <div 
                                    className="w-full bg-blue-500 rounded-t-lg transition-all duration-500 shadow-blue-200 shadow-xl"
                                    style={{ height: `${Math.max(valCorrect * (300/maxVal), 20)}px` }}
                                ></div>
                                <div className="text-center">
                                    <div className="font-mono font-bold text-blue-700 text-lg">4<sup>{exponent}</sup></div>
                                    <div className="text-xs text-blue-600 mt-1">=(2<sup>2</sup>)<sup>{exponent}</sup>=2<sup>{2*exponent}</sup></div>
                                    <div className="text-xs text-slate-400 mt-1">(正确：指数级爆炸)</div>
                                </div>
                            </div>
                        </div>

                        <div className="mt-6 bg-amber-50 border border-amber-200 p-4 rounded-lg text-amber-800 text-sm flex gap-3">
                            <AlertTriangleIcon className="shrink-0" />
                            <p>
                                <strong>直观理解：</strong> 指数运算是“维度”的扩张。当你把底数 4 简单拆成 2×2 时，你只拆了一次；
                                但实际上，4 是在每一层指数上都在发生作用的。x 越大，两者差距就是指数级的拉大！
                            </p>
                        </div>
                    </div>
                </div>
            );
        };

        // Tab 3: Playground
        const PlaygroundLab = () => {
            const [problem, setProblem] = useState(0);
            const [showHint, setShowHint] = useState(false);

            const problems = [
                { 
                    title: "基础练习", 
                    expr: <span>8<sup>x</sup> · 2<sup>y</sup></span>, 
                    base: 2, 
                    hint: "8 可以写成 2 的几次幂？", 
                    step1: <span> (2<sup>3</sup>)<sup>x</sup> · 2<sup>y</sup> </span>,
                    step2: <span> 2<sup>3x</sup> · 2<sup>y</sup> </span>,
                    final: <span> 2<sup>3x+y</sup> </span>
                },
                { 
                    title: "进阶练习", 
                    expr: <span>9<sup>a</sup> · 27<sup>b</sup></span>, 
                    base: 3, 
                    hint: "9 和 27 都是哪个数的亲戚？", 
                    step1: <span> (3<sup>2</sup>)<sup>a</sup> · (3<sup>3</sup>)<sup>b</sup> </span>,
                    step2: <span> 3<sup>2a</sup> · 3<sup>3b</sup> </span>,
                    final: <span> 3<sup>2a+3b</sup> </span>
                }
            ];

            const currentProb = problems[problem];

            return (
                <div className="bg-white p-8 rounded-xl border border-slate-200 shadow-sm max-w-2xl mx-auto">
                    <div className="flex justify-between items-center mb-6">
                        <h3 className="font-bold text-lg text-slate-700">演练场：试着转化下面的式子</h3>
                        <div className="flex gap-2">
                            {problems.map((_, i) => (
                                <button 
                                    key={i}
                                    onClick={() => { setProblem(i); setShowHint(false); }}
                                    className={`w-8 h-8 rounded-full text-xs font-bold ${problem === i ? 'bg-purple-600 text-white' : 'bg-slate-100 text-slate-500'}`}
                                >
                                    {i+1}
                                </button>
                            ))}
                        </div>
                    </div>

                    <div className="text-center py-8 bg-slate-50 rounded-xl border border-slate-100 mb-6">
                        <div className="text-4xl font-serif text-slate-800 mb-4">{currentProb.expr}</div>
                        <p className="text-sm text-slate-500">目标：化为底数为 {currentProb.base} 的形式</p>
                    </div>

                    <div className="space-y-4">
                        <button 
                            onClick={() => setShowHint(!showHint)}
                            className="text-purple-600 text-sm font-bold flex items-center gap-2 hover:underline"
                        >
                            {showHint ? "隐藏步骤" : "显示转化步骤"} <ArrowRightIcon size={14}/>
                        </button>
                        
                        {showHint && (
                            <div className="space-y-4 animate-in slide-in-from-top fade-in duration-300">
                                <div className="flex items-center gap-4 p-3 bg-purple-50 rounded-lg border border-purple-100">
                                    <div className="w-6 h-6 rounded-full bg-purple-200 text-purple-700 flex items-center justify-center text-xs font-bold">1</div>
                                    <div className="font-serif text-lg">{currentProb.step1}</div>
                                    <div className="text-xs text-slate-400 ml-auto hidden sm:block">底数拆解</div>
                                </div>
                                <div className="flex items-center gap-4 p-3 bg-purple-50 rounded-lg border border-purple-100">
                                    <div className="w-6 h-6 rounded-full bg-purple-200 text-purple-700 flex items-center justify-center text-xs font-bold">2</div>
                                    <div className="font-serif text-lg">{currentProb.step2}</div>
                                    <div className="text-xs text-slate-400 ml-auto hidden sm:block">幂的乘方</div>
                                </div>
                                <div className="flex items-center gap-4 p-3 bg-green-50 rounded-lg border border-green-100">
                                    <div className="w-6 h-6 rounded-full bg-green-200 text-green-700 flex items-center justify-center text-xs font-bold">3</div>
                                    <div className="font-serif text-lg font-bold text-green-800">{currentProb.final}</div>
                                    <div className="text-xs text-slate-400 ml-auto hidden sm:block">同底数幂相乘</div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const ExponentLab = () => {
            const [activeTab, setActiveTab] = useState('decompose'); // decompose | compare | playground

            return (
                <div className="flex flex-col h-screen bg-slate-50 font-sans text-slate-800">
                    {/* Header */}
                    <header className="bg-white border-b border-slate-200 p-4 shadow-sm shrink-0">
                        <div className="max-w-5xl mx-auto flex items-center gap-3">
                            <div className="bg-purple-600 text-white p-2 rounded-lg">
                                <BoxIcon size={24} />
                            </div>
                            <div>
                                <h1 className="text-xl font-bold text-slate-900">幂运算原理实验室</h1>
                                <p className="text-xs text-slate-500">探索“同底数转化”的底层逻辑</p>
                            </div>
                        </div>
                    </header>

                    {/* Tabs */}
                    <div className="bg-white border-b border-slate-200">
                        <div className="max-w-5xl mx-auto flex">
                            <TabButton 
                                active={activeTab === 'decompose'} 
                                onClick={() => setActiveTab('decompose')}
                                icon={<SplitIcon size={18} />}
                                label="原理：底数拆解 (细胞分裂)"
                            />
                            <TabButton 
                                active={activeTab === 'compare'} 
                                onClick={() => setActiveTab('compare')}
                                icon={<AlertTriangleIcon size={18} />}
                                label="避坑：为什么不能简单相乘？"
                            />
                            <TabButton 
                                active={activeTab === 'playground'} 
                                onClick={() => setActiveTab('playground')}
                                icon={<CalculatorIcon size={18} />}
                                label="演练：通用转化"
                            />
                        </div>
                    </div>

                    {/* Main Content */}
                    <main className="flex-1 overflow-auto p-4 md:p-8">
                        <div className="max-w-4xl mx-auto">
                            {activeTab === 'decompose' && <DecompositionLab />}
                            {activeTab === 'compare' && <ComparisonLab />}
                            {activeTab === 'playground' && <PlaygroundLab />}
                        </div>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ExponentLab />);
    </script>
</body>
</html>