<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸€æ¬¡å‡½æ•°å¯è§†åŒ–æ¢ç©¶å®éªŒå®¤</title>
    
    <!-- å¼•å…¥ React å’Œ ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- å¼•å…¥ Babel ç”¨äºè§£æ JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body { touch-action: manipulation; }
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #2563eb;
            cursor: pointer;
            margin-top: -8px; 
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #cbd5e1;
            border-radius: 2px;
        }
    </style>
</head>
<body class="bg-slate-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- SVG å›¾æ ‡ ---
        const Settings2 = ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 7h-9"/><path d="M14 17H5"/><circle cx="17" cy="17" r="3"/><circle cx="7" cy="7" r="3"/></svg>;
        const GitCommit = ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"/><line x1="3" y1="12" x2="9" y2="12"/><line x1="15" y1="12" x2="21" y2="12"/></svg>;
        const Move = ({size=16}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="5 9 2 12 5 15"/><polyline points="9 5 12 2 15 5"/><polyline points="15 19 12 22 9 19"/><polyline points="19 15 22 12 19 9"/><line x1="2" y1="12" x2="22" y2="12"/><line x1="12" y1="2" x2="12" y2="22"/></svg>;

        const LinearLab = () => {
            const [mode, setMode] = useState('params'); // 'params' (k,bæ»‘å—) æˆ– 'points' (ä¸¤ç‚¹å®šçº¿)
            
            // Mode 1 State: Parameters
            const [k, setK] = useState(1);
            const [b, setB] = useState(0);

            // Mode 2 State: Two Points
            // P1 é»˜è®¤ (0,0), P2 é»˜è®¤ (2,2)
            const [p1, setP1] = useState({ x: 0, y: 1 });
            const [p2, setP2] = useState({ x: 2, y: 3 });
            const [activePoint, setActivePoint] = useState(null); // 'p1' or 'p2'

            const svgRef = useRef(null);

            // åæ ‡ç³»é…ç½®
            const gridSize = 8; 
            const width = 340;
            const height = 340;
            
            const mapX = (x) => (x + gridSize) * (width / (gridSize * 2));
            const mapY = (y) => height - (y + gridSize) * (height / (gridSize * 2));
            const mapXInverse = (px) => (px / (width / (gridSize * 2))) - gridSize;
            const mapYInverse = (py) => ((height - py) / (height / (gridSize * 2))) - gridSize;

            // --- äº¤äº’é€»è¾‘ ---

            const handlePointerDown = (e, pointName) => {
                if (mode !== 'points') return;
                e.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡
                e.target.setPointerCapture(e.pointerId);
                setActivePoint(pointName);
            };

            const handlePointerMove = (e) => {
                if (mode !== 'points' || !activePoint || !svgRef.current) return;
                
                const rect = svgRef.current.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                // ç®€å•çš„å¸é™„ (0.5æ­¥é•¿)
                let mathX = Math.round(mapXInverse(x) * 2) / 2; 
                let mathY = Math.round(mapYInverse(y) * 2) / 2;
                
                // é™åˆ¶èŒƒå›´
                mathX = Math.max(-gridSize + 0.5, Math.min(gridSize - 0.5, mathX));
                mathY = Math.max(-gridSize + 0.5, Math.min(gridSize - 0.5, mathY));

                if (activePoint === 'p1') {
                    // é¿å…ä¸¤ç‚¹é‡åˆ
                    if (mathX !== p2.x || mathY !== p2.y) setP1({ x: mathX, y: mathY });
                } else {
                    if (mathX !== p1.x || mathY !== p1.y) setP2({ x: mathX, y: mathY });
                }
            };

            const handlePointerUp = (e) => {
                if (activePoint) {
                    setActivePoint(null);
                    if (e.target.releasePointerCapture) {
                        e.target.releasePointerCapture(e.pointerId);
                    }
                }
            };

            // --- è®¡ç®—é€»è¾‘ ---
            
            // ä¸¤ç‚¹æ¨¡å¼ä¸‹è®¡ç®— k å’Œ b
            let currentK, currentB;
            if (mode === 'params') {
                currentK = k;
                currentB = b;
            } else {
                // è®¡ç®—æ–œç‡ k = (y2-y1)/(x2-x1)
                const run = p2.x - p1.x;
                const rise = p2.y - p1.y;
                // é¿å…é™¤ä»¥0 (è™½ç„¶UIä¸Šé™åˆ¶äº†é‡åˆï¼Œä½†å‚ç›´çº¿ä¹Ÿæ˜¯æ— é™æ–œç‡)
                currentK = run === 0 ? 999 : rise / run; 
                // è®¡ç®—æˆªè· b = y - kx
                currentB = p1.y - currentK * p1.x;
            }

            // --- æ¸²æŸ“è¾…åŠ© ---

            const renderGrid = () => {
                const elements = [];
                for (let i = -gridSize; i <= gridSize; i++) {
                    // è·³è¿‡ä¸»è½´ï¼Œä¸»è½´ç”± renderAxes ä¸“é—¨ç”»
                    if (i === 0) continue;

                    const stroke = "#e2e8f0";
                    const lineWidth = 1;
                    
                    elements.push(<line key={`v${i}`} x1={mapX(i)} y1={0} x2={mapX(i)} y2={height} stroke={stroke} strokeWidth={lineWidth} />);
                    elements.push(<line key={`h${i}`} x1={0} y1={mapY(i)} x2={width} y2={mapY(i)} stroke={stroke} strokeWidth={lineWidth} />);
                    
                    // åˆ»åº¦å€¼
                    if (i % 2 === 0) {
                        elements.push(<text key={`tx${i}`} x={mapX(i)} y={mapY(0) + 15} fontSize="10" textAnchor="middle" fill="#94a3b8">{i}</text>);
                        elements.push(<text key={`ty${i}`} x={mapX(0) - 10} y={mapY(i) + 4} fontSize="10" textAnchor="end" fill="#94a3b8">{i}</text>);
                    }
                }
                return elements;
            };

            const renderAxes = () => {
                const axisColor = "#334155";
                return (
                    <g pointerEvents="none">
                        <defs>
                            <marker id="arrow" viewBox="0 0 10 10" refX="5" refY="5"
                                markerWidth="6" markerHeight="6"
                                orient="auto-start-reverse">
                                <path d="M 0 0 L 10 5 L 0 10 z" fill={axisColor} />
                            </marker>
                        </defs>
                        
                        {/* X è½´ */}
                        <line x1={0} y1={mapY(0)} x2={width} y2={mapY(0)} stroke={axisColor} strokeWidth="2" markerEnd="url(#arrow)" />
                        <text x={width - 15} y={mapY(0) + 20} fontSize="14" fontWeight="bold" fill={axisColor} fontStyle="italic">x</text>

                        {/* Y è½´ */}
                        <line x1={mapX(0)} y1={height} x2={mapX(0)} y2={0} stroke={axisColor} strokeWidth="2" markerEnd="url(#arrow)" />
                        <text x={mapX(0) + 10} y={15} fontSize="14" fontWeight="bold" fill={axisColor} fontStyle="italic">y</text>
                        
                        {/* åŸç‚¹ O */}
                        <text x={mapX(0) - 10} y={mapY(0) + 15} fontSize="12" fontStyle="italic" fill="#64748b">O</text>
                    </g>
                );
            };

            // æ¸²æŸ“æ–œç‡ä¸‰è§’å½¢ (ä»…åœ¨ä¸¤ç‚¹æ¨¡å¼)
            const renderSlopeTriangle = () => {
                if (mode !== 'points') return null;
                
                // æ„å»ºç›´è§’ä¸‰è§’å½¢
                const xStart = Math.min(p1.x, p2.x);
                const xEnd = Math.max(p1.x, p2.x);
                const yStart = p1.x < p2.x ? p1.y : p2.y; // å·¦ä¾§ç‚¹çš„y
                const yEnd = p1.x < p2.x ? p2.y : p1.y;   // å³ä¾§ç‚¹çš„y
                
                // æ‹è§’ç‚¹ (xEnd, yStart)
                const cornerX = xEnd;
                const cornerY = yStart;

                const rise = p2.y - p1.y;
                const run = p2.x - p1.x;
                
                const riseColor = rise > 0 ? "#16a34a" : "#dc2626"; // ç»¿è‰²å‡ï¼Œçº¢è‰²é™

                return (
                    <g opacity="0.8">
                        {/* Run (æ°´å¹³) */}
                        <line x1={mapX(xStart)} y1={mapY(yStart)} x2={mapX(xEnd)} y2={mapY(yStart)} 
                            stroke="#64748b" strokeWidth="2" strokeDasharray="4,4" />
                        
                        {/* Rise (å‚ç›´) */}
                        <line x1={mapX(cornerX)} y1={mapY(cornerY)} x2={mapX(xEnd)} y2={mapY(yEnd)} 
                            stroke={riseColor} strokeWidth="2" strokeDasharray="4,4" />
                        
                        {/* æ–‡å­—æ ‡æ³¨ */}
                        <text x={mapX((xStart + xEnd)/2)} y={mapY(yStart) + 15} textAnchor="middle" fill="#64748b" fontSize="12" fontWeight="bold">
                            Run: {Math.abs(run)}
                        </text>
                        <text x={mapX(xEnd) + 5} y={mapY((yStart + yEnd)/2)} textAnchor="start" fill={riseColor} fontSize="12" fontWeight="bold">
                            Rise: {rise}
                        </text>
                    </g>
                );
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-4 font-sans text-slate-800">
                    
                    <div className="bg-white rounded-2xl shadow-xl w-full max-w-4xl overflow-hidden flex flex-col md:flex-row">
                        
                        {/* å·¦ä¾§ï¼šå¯è§†åŒ–åŒºåŸŸ */}
                        <div className="flex-1 p-6 bg-slate-50 flex flex-col items-center border-b md:border-b-0 md:border-r border-slate-100 relative">
                            {/* åæ ‡è½´è¯´æ˜æ ‡ç­¾ */}
                            <div className="absolute top-4 left-4 z-10 bg-white/80 backdrop-blur px-3 py-1 rounded-full shadow-sm text-xs font-mono text-slate-500 border border-slate-200">
                                åæ ‡åŸç‚¹ O(0,0)
                            </div>
                            
                            <svg 
                                ref={svgRef}
                                width={width} 
                                height={height} 
                                className="bg-white rounded-xl shadow-inner border border-slate-200 cursor-default touch-none"
                                onPointerMove={handlePointerMove}
                                onPointerUp={handlePointerUp}
                                onPointerLeave={handlePointerUp}
                            >
                                {/* ç½‘æ ¼ */}
                                {renderGrid()}
                                
                                {/* åæ ‡è½´ (æ”¾åœ¨ç½‘æ ¼ä¹‹ä¸Š) */}
                                {renderAxes()}

                                {/* ç›´çº¿ */}
                                {Math.abs(currentK) < 100 && (
                                    <line 
                                        x1={mapX(-gridSize)} 
                                        y1={mapY(currentK * -gridSize + currentB)} 
                                        x2={mapX(gridSize)} 
                                        y2={mapY(currentK * gridSize + currentB)} 
                                        stroke="#3b82f6" 
                                        strokeWidth="3"
                                    />
                                )}

                                {/* ä¸¤ç‚¹æ¨¡å¼ä¸‹çš„è¾…åŠ©å…ƒç´  */}
                                {renderSlopeTriangle()}

                                {/* æˆªè·ç‚¹æ˜¾ç¤º (b) */}
                                <circle cx={mapX(0)} cy={mapY(currentB)} r="4" fill="#f59e0b" />
                                {mode === 'params' && (
                                     <text x={mapX(0) + 8} y={mapY(currentB)} dy="4" fontSize="12" fill="#f59e0b" fontWeight="bold">b</text>
                                )}

                                {/* äº¤äº’ç‚¹ (ä¸¤ç‚¹æ¨¡å¼) */}
                                {mode === 'points' && (
                                    <>
                                        {/* P1 */}
                                        <g 
                                            transform={`translate(${mapX(p1.x)}, ${mapY(p1.y)})`} 
                                            onPointerDown={(e) => handlePointerDown(e, 'p1')}
                                            className="cursor-move"
                                        >
                                            <circle r="12" fill="transparent" /> {/* æ‰©å¤§ç‚¹å‡»åŒºåŸŸ */}
                                            <circle r="6" fill="#3b82f6" stroke="white" strokeWidth="2" />
                                            <text y="-10" textAnchor="middle" fontSize="12" fill="#3b82f6" fontWeight="bold">P1</text>
                                        </g>
                                        
                                        {/* P2 */}
                                        <g 
                                            transform={`translate(${mapX(p2.x)}, ${mapY(p2.y)})`} 
                                            onPointerDown={(e) => handlePointerDown(e, 'p2')}
                                            className="cursor-move"
                                        >
                                            <circle r="12" fill="transparent" />
                                            <circle r="6" fill="#3b82f6" stroke="white" strokeWidth="2" />
                                            <text y="-10" textAnchor="middle" fontSize="12" fill="#3b82f6" fontWeight="bold">P2</text>
                                        </g>
                                    </>
                                )}
                            </svg>
                        </div>

                        {/* å³ä¾§ï¼šæ§åˆ¶é¢æ¿ */}
                        <div className="w-full md:w-80 p-6 flex flex-col">
                            
                            {/* æ¨¡å¼åˆ‡æ¢ Tabs */}
                            <div className="flex bg-slate-100 p-1 rounded-lg mb-6">
                                <button 
                                    onClick={() => setMode('params')}
                                    className={`flex-1 flex items-center justify-center gap-2 py-2 text-sm font-bold rounded-md transition-all ${mode === 'params' ? 'bg-white shadow text-blue-600' : 'text-slate-500 hover:text-slate-700'}`}
                                >
                                    <Settings2 size={16} /> å‚æ•°æ¢ç©¶
                                </button>
                                <button 
                                    onClick={() => setMode('points')}
                                    className={`flex-1 flex items-center justify-center gap-2 py-2 text-sm font-bold rounded-md transition-all ${mode === 'points' ? 'bg-white shadow text-blue-600' : 'text-slate-500 hover:text-slate-700'}`}
                                >
                                    <GitCommit size={16} /> ä¸¤ç‚¹å®šçº¿
                                </button>
                            </div>

                            {/* åŠ¨æ€å…¬å¼å±•ç¤º */}
                            <div className="bg-slate-800 text-white p-4 rounded-xl mb-6 text-center shadow-lg">
                                <div className="text-xs text-slate-400 mb-1">å½“å‰ç›´çº¿æ–¹ç¨‹</div>
                                <div className="text-2xl font-mono tracking-wide">
                                    y = 
                                    <span className="text-blue-400 mx-1">{Number(currentK).toFixed(1)}</span>
                                    x 
                                    <span className="text-yellow-400 mx-1">{currentB >= 0 ? '+' : ''}{Number(currentB).toFixed(1)}</span>
                                </div>
                            </div>

                            {/* æ§åˆ¶åŒºåŸŸ */}
                            <div className="flex-1 space-y-8">
                                
                                {mode === 'params' ? (
                                    <>
                                        {/* k Slider */}
                                        <div className="space-y-3">
                                            <div className="flex justify-between items-center">
                                                <label className="font-bold text-slate-700 flex items-center gap-2">
                                                    <span className="bg-blue-100 text-blue-700 w-6 h-6 flex items-center justify-center rounded text-sm">k</span>
                                                    æ–œç‡ (Slope)
                                                </label>
                                                <span className="font-mono bg-slate-100 px-2 rounded">{k.toFixed(1)}</span>
                                            </div>
                                            <input 
                                                type="range" min="-5" max="5" step="0.1" value={k} 
                                                onChange={(e) => setK(parseFloat(e.target.value))}
                                            />
                                            <p className="text-xs text-slate-500 bg-slate-50 p-2 rounded">
                                                ğŸ’¡ <b>è§‚å¯Ÿï¼š</b> k å†³å®šç›´çº¿çš„<b>é™¡å³­ç¨‹åº¦</b>å’Œ<b>æ–¹å‘</b>ã€‚è¯•ç€æŠŠ k å˜æˆè´Ÿæ•°çœ‹çœ‹ã€‚
                                            </p>
                                        </div>

                                        {/* b Slider */}
                                        <div className="space-y-3">
                                            <div className="flex justify-between items-center">
                                                <label className="font-bold text-slate-700 flex items-center gap-2">
                                                    <span className="bg-yellow-100 text-yellow-700 w-6 h-6 flex items-center justify-center rounded text-sm">b</span>
                                                    æˆªè· (Intercept)
                                                </label>
                                                <span className="font-mono bg-slate-100 px-2 rounded">{b.toFixed(1)}</span>
                                            </div>
                                            <input 
                                                type="range" min="-5" max="5" step="0.5" value={b} 
                                                onChange={(e) => setB(parseFloat(e.target.value))}
                                            />
                                            <p className="text-xs text-slate-500 bg-slate-50 p-2 rounded">
                                                ğŸ’¡ <b>è§‚å¯Ÿï¼š</b> b å†³å®šç›´çº¿ä¸ Y è½´çš„äº¤ç‚¹ã€‚æ”¹å˜ b ä¼šè®©ç›´çº¿<b>ä¸Šä¸‹å¹³ç§»</b>ã€‚
                                            </p>
                                        </div>
                                    </>
                                ) : (
                                    /* ä¸¤ç‚¹æ¨¡å¼è¯´æ˜ */
                                    <div className="space-y-4 animate-in fade-in">
                                        <div className="bg-blue-50 border border-blue-100 p-4 rounded-lg">
                                            <h4 className="font-bold text-blue-900 mb-2 flex items-center gap-2">
                                                <Move size={16} /> æ“ä½œæŒ‡å—
                                            </h4>
                                            <p className="text-sm text-blue-800 leading-relaxed">
                                                è¯·åœ¨å·¦ä¾§å›¾è¡¨ä¸­<b>æ‹–åŠ¨ç‚¹ P1 å’Œ P2</b>ã€‚
                                            </p>
                                        </div>
                                        
                                        <div className="space-y-2">
                                            <h4 className="text-sm font-bold text-slate-600">æ–œç‡è®¡ç®—åŸç†ï¼š</h4>
                                            <div className="bg-white border p-3 rounded text-sm space-y-2 font-mono text-slate-600">
                                                <div className="flex justify-between">
                                                    <span>Run (æ°´å¹³è·ç¦»):</span>
                                                    <span>{Math.abs(p2.x - p1.x).toFixed(1)}</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span>Rise (å‚ç›´é«˜åº¦):</span>
                                                    <span className={p2.y - p1.y > 0 ? "text-green-600" : "text-red-600"}>{(p2.y - p1.y).toFixed(1)}</span>
                                                </div>
                                                <div className="border-t pt-2 mt-2 flex justify-between font-bold text-slate-800">
                                                    <span>k = Rise / Run:</span>
                                                    <span>{currentK.toFixed(2)}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<LinearLab />);
    </script>
</body>
</html>