<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‰©ç†æ¨¡æ‹Ÿï¼šé›¨åå¤œè·¯ä¸å…‰çš„åå°„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #0f172a; color: #e2e8f0; }
        canvas { background: radial-gradient(circle at 50% 10%, #1e293b, #0f172a); border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.5); }
        .panel { background: rgba(30, 41, 59, 0.8); backdrop-filter: blur(8px); border: 1px solid rgba(255,255,255,0.1); }
        .btn-active { background-color: #3b82f6; color: white; border-color: #3b82f6; }
        .btn-inactive { background-color: transparent; color: #94a3b8; border-color: #475569; }
        .eye-view-canvas { border: 4px solid #334155; border-radius: 50%; background: #000; box-shadow: inset 0 0 20px rgba(0,0,0,0.8); }
    </style>
</head>
<body class="flex flex-col items-center min-h-screen p-2 md:p-6">

    <header class="w-full max-w-5xl mb-4 flex flex-col md:flex-row justify-between items-center gap-4">
        <div>
            <h1 class="text-2xl md:text-3xl font-bold text-blue-400">ğŸŒ§ï¸ é›¨åå¤œè·¯ï¼šèµ°äº®å¤„è¿˜æ˜¯èµ°æš—å¤„ï¼Ÿ</h1>
            <p class="text-slate-400 text-sm mt-1">æ¼«åå°„ vs é•œé¢åå°„çš„å¯è§†åŒ–åŸç†è§£æ</p>
        </div>
        
        <!-- æ ¸å¿ƒæ§åˆ¶å™¨ -->
        <div class="flex bg-slate-800 rounded-lg p-1 border border-slate-700">
            <button id="btnBehind" onclick="setScenario('behind')" class="px-4 py-2 rounded-md font-medium text-sm transition-all btn-active">
                ğŸŒ‘ èƒŒç€æœˆå…‰èµ° (é¢˜ç›®åœºæ™¯)
            </button>
            <button id="btnFront" onclick="setScenario('front')" class="px-4 py-2 rounded-md font-medium text-sm transition-all btn-inactive">
                ğŸŒ• è¿ç€æœˆå…‰èµ° (æ‹“å±•æ€è€ƒ)
            </button>
        </div>
    </header>

    <main class="w-full max-w-6xl flex flex-col lg:flex-row gap-6">
        
        <!-- å·¦ä¾§ï¼šä¸»æ¨¡æ‹ŸåŒº -->
        <div class="flex-1 relative group">
            <div class="absolute top-4 left-4 z-10 bg-black/60 px-3 py-1 rounded text-xs text-blue-200 pointer-events-none">
                ä¾§è§†å›¾ (å…‰è·¯åŸç†)
            </div>
            <canvas id="mainCanvas" class="w-full aspect-[16/9] cursor-crosshair"></canvas>
            
            <!-- æ ‡æ³¨è¯´æ˜ -->
            <div class="flex justify-center gap-6 mt-2 text-xs text-slate-500">
                <div class="flex items-center"><span class="w-3 h-3 bg-blue-500 rounded-full mr-2 opacity-50"></span>æ°´å‘ (é•œé¢åå°„)</div>
                <div class="flex items-center"><span class="w-3 h-3 bg-slate-600 rounded-full mr-2"></span>åœ°é¢ (æ¼«åå°„)</div>
                <div class="flex items-center"><span class="w-20 h-0.5 bg-yellow-400 opacity-50 mr-2"></span>å…‰çº¿</div>
            </div>
        </div>

        <!-- å³ä¾§ï¼šæ•™å­¦é¢æ¿ä¸POV -->
        <div class="w-full lg:w-80 flex flex-col gap-4">
            
            <!-- POV è§†è§’ï¼šæ¨¡æ‹Ÿäººçœ¼çœ‹åˆ°çš„æ™¯è±¡ -->
            <div class="panel rounded-xl p-4 flex flex-col items-center">
                <h3 class="text-sm font-bold text-slate-300 mb-3 w-full flex justify-between">
                    <span>ğŸ‘€ äººçœ¼è§†è§’æ¨¡æ‹Ÿ</span>
                    <span id="povLabel" class="text-blue-400">èƒŒå¯¹æœˆäº®</span>
                </h3>
                <div class="relative">
                    <canvas id="povCanvas" width="200" height="200" class="eye-view-canvas"></canvas>
                    <div class="absolute bottom-4 left-0 w-full text-center text-xs text-white/70 drop-shadow-md">
                        ä½ çœ‹åˆ°çš„æ™¯è±¡
                    </div>
                </div>
                <div id="povDescription" class="mt-4 text-center text-sm p-2 bg-slate-800/50 rounded border border-slate-700 text-yellow-100">
                    <!-- JS åŠ¨æ€å¡«å…… -->
                </div>
            </div>

            <!-- åŸç†è®²è§£å¡ç‰‡ -->
            <div class="panel rounded-xl p-5 flex-1">
                <h3 class="font-bold text-blue-400 border-b border-slate-700 pb-2 mb-3">ğŸ“ ç‰©ç†åŸç†æ‹†è§£</h3>
                <div id="explanationContent" class="space-y-3 text-sm text-slate-300 leading-relaxed">
                    <!-- JS åŠ¨æ€å¡«å…… -->
                </div>
            </div>

        </div>
    </main>

    <script>
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');
        const povCanvas = document.getElementById('povCanvas');
        const povCtx = povCanvas.getContext('2d');

        // çŠ¶æ€ç®¡ç†
        let state = {
            moonPosition: 'behind', // 'behind' (left) or 'front' (right)
            rays: [],
            particles: []
        };

        // åœºæ™¯é…ç½®
        const config = {
            groundY: 0, // ä¼šåœ¨ resize ä¸­è®¡ç®—
            waterStart: 0.45, // å±å¹•å®½åº¦çš„ç™¾åˆ†æ¯”
            waterWidth: 0.15,
            observerX: 0.35, // è§‚å¯Ÿè€…ä½ç½®
            observerHeight: 120
        };

        // åˆå§‹åŒ–å°ºå¯¸
        function resize() {
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * 2; // Retina æ”¯æŒ
            canvas.height = rect.height * 2;
            ctx.scale(2, 2);
            config.groundY = rect.height * 0.85;
            
            // ç®€å•çš„ POV é‡ç»˜
            drawPOV();
        }
        window.addEventListener('resize', resize);

        // åˆ‡æ¢åœºæ™¯
        window.setScenario = function(type) {
            state.moonPosition = type;
            state.rays = []; // æ¸…ç©ºç°æœ‰å…‰çº¿
            
            // æ›´æ–°æŒ‰é’®æ ·å¼
            const btnBehind = document.getElementById('btnBehind');
            const btnFront = document.getElementById('btnFront');
            
            if(type === 'behind') {
                btnBehind.className = "px-4 py-2 rounded-md font-medium text-sm transition-all btn-active";
                btnFront.className = "px-4 py-2 rounded-md font-medium text-sm transition-all btn-inactive";
            } else {
                btnBehind.className = "px-4 py-2 rounded-md font-medium text-sm transition-all btn-inactive";
                btnFront.className = "px-4 py-2 rounded-md font-medium text-sm transition-all btn-active";
            }
            
            updateText();
        }

        // æ›´æ–°æ–‡æœ¬è¯´æ˜
        function updateText() {
            const label = document.getElementById('povLabel');
            const desc = document.getElementById('povDescription');
            const expl = document.getElementById('explanationContent');

            if (state.moonPosition === 'behind') {
                label.innerText = "èƒŒç€æœˆå…‰";
                // ç»“è®ºï¼šæ°´æš—ï¼Œåœ°äº®
                desc.innerHTML = `æ°´å‘æ˜¯ <span class="text-xl font-bold text-slate-500">æš—</span> çš„<br>åœ°é¢æ˜¯ <span class="text-xl font-bold text-slate-200">äº®</span> çš„`;
                expl.innerHTML = `
                    <p><strong class="text-blue-300">1. å…‰æºä½ç½®ï¼š</strong>æœˆäº®åœ¨ä½ èº«åï¼Œå…‰çº¿ä»åä¸Šæ–¹å°„æ¥ã€‚</p>
                    <p><strong class="text-blue-300">2. æ°´å‘ (é•œé¢åå°„)ï¼š</strong>è¡¨é¢å…‰æ»‘ã€‚å…‰çº¿å°„åˆ°æ°´é¢ï¼Œéµå¾ªåå°„å®šå¾‹ï¼Œåå°„å…‰çº¿<span class="text-red-400">å‘å‰é£å»</span>ï¼ˆè¿œç¦»ä½ ï¼‰ï¼Œæ²¡æœ‰å…‰çº¿è¿›å…¥çœ¼ç›ã€‚</p>
                    <p><strong class="text-blue-300">3. åœ°é¢ (æ¼«åå°„)ï¼š</strong>è¡¨é¢ç²—ç³™ã€‚å…‰çº¿å°„åˆ°åœ°é¢ï¼Œå‘å››é¢å…«æ–¹æ•£å°„ï¼Œ<span class="text-green-400">éƒ¨åˆ†å…‰çº¿åå°„å›çœ¼ç›</span>ã€‚</p>
                    <div class="p-2 bg-blue-900/30 rounded border border-blue-800 mt-2 text-center font-bold text-blue-200">
                        ğŸ‘‰ ç»“è®ºï¼šä¸ºäº†é¿å‘ï¼Œèµ°äº®çš„åœ°æ–¹ã€‚
                    </div>
                `;
            } else {
                label.innerText = "è¿ç€æœˆå…‰";
                // ç»“è®ºï¼šæ°´äº®ï¼Œåœ°æš—
                desc.innerHTML = `æ°´å‘æ˜¯ <span class="text-xl font-bold text-white text-shadow-glow">æäº®</span> çš„<br>åœ°é¢æ˜¯ <span class="text-xl font-bold text-slate-500">è¾ƒæš—</span> çš„`;
                expl.innerHTML = `
                    <p><strong class="text-yellow-300">1. å…‰æºä½ç½®ï¼š</strong>æœˆäº®åœ¨ä½ æ­£å‰æ–¹ï¼Œå…‰çº¿è¿é¢å°„æ¥ã€‚</p>
                    <p><strong class="text-yellow-300">2. æ°´å‘ (é•œé¢åå°„)ï¼š</strong>å…‰çº¿å°„åˆ°æ°´é¢ï¼Œåå°„å…‰çº¿<span class="text-green-400">æ°å¥½ç›´æ¥å°„å…¥çœ¼ç›</span>ï¼Œèƒ½é‡é›†ä¸­ï¼Œçœ‹èµ·æ¥éå¸¸åˆºçœ¼ï¼ˆäº®ï¼‰ã€‚</p>
                    <p><strong class="text-yellow-300">3. åœ°é¢ (æ¼«åå°„)ï¼š</strong>å…‰çº¿å‘å››å‘¨æ•£å°„ï¼Œå°„å…¥çœ¼ç›çš„å…‰çº¿ç›¸å¯¹è¾ƒå°‘ï¼Œæ˜¾å¾—è¾ƒæš—ã€‚</p>
                    <div class="p-2 bg-yellow-900/30 rounded border border-yellow-800 mt-2 text-center font-bold text-yellow-200">
                        ğŸ‘‰ ç»“è®ºï¼šä¸ºäº†é¿å‘ï¼Œèµ°æš—çš„åœ°æ–¹ã€‚
                    </div>
                `;
            }
        }

        // åŠ¨ç”»å¾ªç¯
        function animate() {
            const w = canvas.width / 2;
            const h = canvas.height / 2;
            ctx.clearRect(0, 0, w, h);

            drawScene(ctx, w, h);
            drawRays(ctx, w, h);
            drawObserver(ctx, w, h);
            drawPOV(); // æŒç»­åˆ·æ–° POV ä»¥äº§ç”Ÿå¾®å¼±é—ªçƒæ•ˆæœ

            requestAnimationFrame(animate);
        }

        // ç»˜åˆ¶åœºæ™¯èƒŒæ™¯
        function drawScene(ctx, w, h) {
            const gY = config.groundY;

            // åœ°é¢
            ctx.fillStyle = '#1e293b';
            ctx.fillRect(0, gY, w, h - gY);
            
            // ç»˜åˆ¶ç²—ç³™åœ°é¢ç»†èŠ‚
            ctx.strokeStyle = '#475569';
            ctx.lineWidth = 1;
            for(let i=0; i<w; i+=5) {
                if(i > w * config.waterStart && i < w * (config.waterStart + config.waterWidth)) continue;
                ctx.beginPath();
                ctx.moveTo(i, gY);
                ctx.lineTo(i + 2, gY - Math.random() * 3); // æ¨¡æ‹Ÿç²—ç³™
                ctx.stroke();
            }

            // æ°´å‘
            const wx = w * config.waterStart;
            const ww = w * config.waterWidth;
            
            // æ°´å‘åº•è‰²
            ctx.fillStyle = '#0f172a';
            ctx.fillRect(wx, gY, ww, 4);
            
            // æ°´é¢é•œé¢æ•ˆæœ
            const gradient = ctx.createLinearGradient(wx, 0, wx + ww, 0);
            gradient.addColorStop(0, 'rgba(59, 130, 246, 0.2)');
            gradient.addColorStop(0.5, 'rgba(59, 130, 246, 0.4)');
            gradient.addColorStop(1, 'rgba(59, 130, 246, 0.2)');
            ctx.fillStyle = gradient;
            ctx.fillRect(wx, gY, ww, 2);

            // æœˆäº®
            const moonX = state.moonPosition === 'behind' ? 50 : w - 50;
            const moonY = 50;
            ctx.beginPath();
            ctx.arc(moonX, moonY, 20, 0, Math.PI * 2);
            ctx.fillStyle = '#fef3c7';
            ctx.shadowBlur = 40;
            ctx.shadowColor = '#fef3c7';
            ctx.fill();
            ctx.shadowBlur = 0; // é‡ç½®
            ctx.fillStyle = '#000'; // æ–‡å­—
            ctx.font = '10px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText("æœˆäº®", moonX, moonY);
        }

        // ç»˜åˆ¶è§‚å¯Ÿè€…
        function drawObserver(ctx, w, h) {
            const x = w * config.observerX;
            const y = config.groundY;
            const height = config.observerHeight;

            // ç®€å•çš„ç«æŸ´äºº/å‰ªå½±
            ctx.strokeStyle = '#94a3b8';
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';

            // è…¿
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(x - 10, y - 40);
            ctx.lineTo(x, y - 80); // èº¯å¹²åº•
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x + 20, y); // å‰è…¿
            ctx.lineTo(x + 5, y - 40);
            ctx.lineTo(x, y - 80);
            ctx.stroke();

            // èº¯å¹²
            ctx.beginPath();
            ctx.moveTo(x, y - 80);
            ctx.lineTo(x + 5, y - 130); // é¢ˆéƒ¨
            ctx.stroke();

            // å¤´
            ctx.fillStyle = '#cbd5e1';
            ctx.beginPath();
            ctx.arc(x + 8, y - 145, 12, 0, Math.PI * 2);
            ctx.fill();

            // çœ¼ç›ä½ç½®æ ‡æ³¨
            ctx.fillStyle = '#3b82f6';
            ctx.beginPath();
            const eyeX = x + 18;
            const eyeY = y - 145;
            ctx.arc(eyeX, eyeY, 3, 0, Math.PI * 2);
            ctx.fill();

            // è§†çº¿æ–¹å‘æŒ‡ç¤º
            ctx.strokeStyle = 'rgba(255,255,255,0.1)';
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(eyeX, eyeY);
            ctx.lineTo(eyeX + 200, eyeY + 80); // å‘ä¸‹çœ‹è·¯
            ctx.stroke();
            ctx.setLineDash([]);
        }

        // æ ¸å¿ƒç‰©ç†å¼•æ“ï¼šå…‰çº¿ç”Ÿæˆä¸åå°„
        function drawRays(ctx, w, h) {
            // æ¯å¸§ç”Ÿæˆä¸€äº›æ–°å…‰çº¿
            if(Math.random() > 0.1) {
                const moonX = state.moonPosition === 'behind' ? 0 : w;
                const moonY = 0;
                
                // ç›®æ ‡åŒºåŸŸè¦†ç›–æ°´å‘å’Œå‘¨å›´åœ°é¢
                const targetStart = w * (config.waterStart - 0.1);
                const targetEnd = w * (config.waterStart + config.waterWidth + 0.1);
                const targetX = targetStart + Math.random() * (targetEnd - targetStart);
                const targetY = config.groundY;

                state.rays.push({
                    x: moonX,
                    y: moonY,
                    tx: targetX, // ç›®æ ‡è½ç‚¹
                    ty: targetY,
                    stage: 0, // 0: ä¸‹è½, 1: åå°„
                    progress: 0,
                    type: null, // 'water' or 'ground'
                    scatterAngle: 0
                });
            }

            // æ›´æ–°å’Œç»˜åˆ¶å…‰çº¿
            ctx.lineWidth = 1;

            const observerEyeX = w * config.observerX + 18;
            const observerEyeY = config.groundY - 145;

            for (let i = state.rays.length - 1; i >= 0; i--) {
                let r = state.rays[i];
                r.progress += 0.04; // é€Ÿåº¦

                // é˜¶æ®µ 1: å…‰çº¿å°„å‘åœ°é¢/æ°´é¢
                if (r.stage === 0) {
                    const cx = r.x + (r.tx - r.x) * r.progress;
                    const cy = r.y + (r.ty - r.y) * r.progress;

                    // ç»˜åˆ¶å…‰å­å°¾è¿¹
                    const tailX = r.x + (r.tx - r.x) * (r.progress - 0.1);
                    const tailY = r.y + (r.ty - r.y) * (r.progress - 0.1);
                    
                    ctx.strokeStyle = 'rgba(255, 255, 100, 0.4)';
                    ctx.beginPath();
                    ctx.moveTo(Math.max(r.x, tailX), Math.max(r.y, tailY));
                    ctx.lineTo(cx, cy);
                    ctx.stroke();

                    if (r.progress >= 1) {
                        r.stage = 1;
                        r.progress = 0;
                        r.x = r.tx;
                        r.y = r.ty;
                        
                        // åˆ¤å®šæè´¨
                        const waterStart = w * config.waterStart;
                        const waterEnd = w * (config.waterStart + config.waterWidth);
                        
                        if (r.tx >= waterStart && r.tx <= waterEnd) {
                            r.type = 'water';
                            // é•œé¢åå°„è®¡ç®—
                            // å…¥å°„å‘é‡ (dx, dy)
                            const idx = r.tx - (state.moonPosition === 'behind' ? 0 : w);
                            const idy = r.ty - 0;
                            // é•œé¢åå°„ï¼šæ°´å¹³åˆ†é‡ä¸å˜(å¯¹äºå‚ç›´ç•Œé¢)ï¼Œä½†è¿™é‡Œæ˜¯æ°´å¹³ç•Œé¢ï¼Œæ‰€ä»¥å‚ç›´åˆ†é‡åå‘ï¼Œæ°´å¹³åˆ†é‡ä¿æŒç»§ç»­å‘å‰
                            // å…¶å®ç®€å•ç†è§£ï¼šå…¥å°„è§’ç­‰äºåå°„è§’
                            // å¦‚æœæ˜¯ä»å·¦è¾¹å°„æ¥(behind)ï¼Œdxæ˜¯æ­£çš„ï¼Œåå°„åç»§ç»­å¾€å³é£
                            // å¦‚æœæ˜¯ä»å³è¾¹å°„æ¥(front)ï¼Œdxæ˜¯è´Ÿçš„ï¼Œåå°„åç»§ç»­å¾€å·¦é£
                            
                            // ä¿®æ­£é€»è¾‘ï¼š
                            // é•œé¢åå°„ï¼šå…¥å°„è§’ = åå°„è§’ã€‚
                            // å¦‚æœå…‰ä»å·¦ä¸Šæ–¹æ¥ï¼Œåå°„å‘å³ä¸Šæ–¹ã€‚
                            const angleIncidence = Math.atan2(idy, Math.abs(idx));
                            // åå°„å‘é‡ï¼š
                            const dirX = state.moonPosition === 'behind' ? 1 : -1;
                            r.vx = Math.cos(angleIncidence) * 800 * dirX; 
                            r.vy = -Math.sin(angleIncidence) * 800; // å‘ä¸Š
                        } else {
                            r.type = 'ground';
                            // æ¼«åå°„ï¼šéšæœºè§’åº¦å‘ä¸Šæ•£å°„
                            const angle = -Math.PI * 0.1 - Math.random() * Math.PI * 0.8; // -18åº¦ åˆ° -162åº¦ (å‘ä¸Šæ‰‡å½¢)
                            const dist = 600; // å°„ç¨‹
                            r.vx = Math.cos(angle) * dist;
                            r.vy = Math.sin(angle) * dist;
                        }
                    }
                } 
                // é˜¶æ®µ 2: åå°„/æ•£å°„
                else if (r.stage === 1) {
                    const cx = r.x + r.vx * r.progress;
                    const cy = r.y + r.vy * r.progress;
                    const tailX = r.x + r.vx * (r.progress - 0.05);
                    const tailY = r.y + r.vy * (r.progress - 0.05);

                    // é¢œè‰²åŒºåˆ†ï¼šé•œé¢åå°„å…‰æ›´å¼ºæ›´ç›´
                    ctx.strokeStyle = r.type === 'water' 
                        ? 'rgba(100, 200, 255, 0.6)' 
                        : 'rgba(255, 255, 200, 0.15)'; // æ¼«åå°„è¾ƒå¼±
                    
                    ctx.beginPath();
                    ctx.moveTo(tailX, tailY);
                    ctx.lineTo(cx, cy);
                    ctx.stroke();

                    // æ£€æµ‹æ˜¯å¦å‡»ä¸­çœ¼ç› (ç®€å•çš„è·ç¦»åˆ¤å®š)
                    // è®¡ç®—å…‰çº¿æ®µä¸çœ¼ç›ç‚¹çš„è·ç¦»
                    // è¿™é‡Œç®€åŒ–ä¸ºï¼šå¦‚æœåœ¨çœ¼ç›é™„è¿‘
                    const distToEye = Math.hypot(cx - observerEyeX, cy - observerEyeY);
                    if (distToEye < 20) {
                        // å‡»ä¸­çœ¼ç›ç‰¹æ•ˆ
                        ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                        ctx.beginPath();
                        ctx.arc(observerEyeX, observerEyeY, 4, 0, Math.PI*2);
                        ctx.fill();
                    }

                    if (r.progress > 1) {
                        state.rays.splice(i, 1);
                    }
                }
            }
        }

        // ç»˜åˆ¶ POV (å³ä¸‹è§’çš„å°åœ†çª—)
        function drawPOV() {
            const w = povCanvas.width;
            const h = povCanvas.height;
            povCtx.clearRect(0, 0, w, h);

            // 1. ç»˜åˆ¶èƒŒæ™¯ï¼ˆè·¯é¢ï¼‰
            // åœ¨å¤œé—´ï¼Œè·¯é¢åº”è¯¥æ˜¯ç°æš—çš„ï¼Œä½†åœ¨æ¼«åå°„ä¸‹ä¼šæœ‰ä¸€ç‚¹ç‚¹äº®åº¦
            const groundColor = state.moonPosition === 'behind' ? '#475569' : '#1e293b'; // Behindæ—¶åœ°æ˜¯äº®çš„
            
            // æ¸å˜æ¨¡æ‹Ÿé€è§†è·¯é¢
            const grad = povCtx.createLinearGradient(0, 0, 0, h);
            grad.addColorStop(0, '#000'); // è¿œå¤„é»‘
            grad.addColorStop(1, groundColor); // è¿‘å¤„ç”±æ¼«åå°„å†³å®šäº®åº¦
            povCtx.fillStyle = grad;
            povCtx.fillRect(0, 0, w, h);

            // 2. ç»˜åˆ¶æ°´å‘
            povCtx.save();
            povCtx.translate(w/2, h/2 + 20);
            povCtx.scale(1, 0.3); // å‹æ‰æˆæ¤­åœ†
            povCtx.beginPath();
            povCtx.arc(0, 0, 60, 0, Math.PI * 2);
            
            if (state.moonPosition === 'behind') {
                // èƒŒç€æœˆå…‰ï¼šæ°´æ˜¯æš—çš„ï¼ˆç”šè‡³æ¯”è·¯é¢æ›´é»‘ï¼Œå› ä¸ºåå°„äº†å‰æ–¹é»‘æš—çš„å¤©ç©ºï¼‰
                povCtx.fillStyle = '#020617'; 
                povCtx.fill();
                povCtx.strokeStyle = '#1e293b';
                povCtx.stroke();
            } else {
                // è¿ç€æœˆå…‰ï¼šæ°´æ˜¯æäº®çš„ï¼ˆåå°„äº†æœˆå…‰ï¼‰
                povCtx.fillStyle = '#fff';
                povCtx.shadowBlur = 30;
                povCtx.shadowColor = '#fff';
                povCtx.fill();
                
                // åŠ ç‚¹ç‚«å…‰
                povCtx.fillStyle = 'rgba(255,255,255,0.8)';
                povCtx.fillRect(-80, -2, 160, 4);
                povCtx.fillRect(-2, -80, 4, 160);
            }
            povCtx.restore();
            
            // 3. å™ªç‚¹æ¨¡æ‹Ÿæ¼«åå°„è´¨æ„Ÿï¼ˆä»…åœ°é¢ï¼‰
            // ç®€åŒ–å¤„ç†ï¼šåœ¨äº®åœ°æ¨¡å¼ä¸‹åŠ ç‚¹æ‚è‰²
            if (state.moonPosition === 'behind') {
                 povCtx.fillStyle = 'rgba(255,255,255,0.05)';
                 for(let k=0; k<100; k++) {
                     povCtx.fillRect(Math.random()*w, h/2 + Math.random()*h/2, 2, 2);
                 }
            }
        }

        // å¯åŠ¨
        setTimeout(resize, 100);
        updateText();
        animate();

    </script>
</body>
</html>