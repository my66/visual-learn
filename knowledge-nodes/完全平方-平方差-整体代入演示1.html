<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>代数公式：从几何到整体代换</title>
    <!-- 引入 Tailwind CSS 用于样式 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Vue 3 用于交互逻辑 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- 引入 MathJax 用于漂亮的数学公式渲染 (配置为支持动态刷新) -->
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
            svg: { fontCache: 'global' }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        /* 自定义一些过渡动画 */
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.5s ease;
        }
        .fade-enter-from, .fade-leave-to {
            opacity: 0;
        }
        
        .math-box {
            transition: all 0.3s ease;
        }
        
        /* 用于占位符的样式 */
        .placeholder-a {
            background-color: #dbeafe; /* blue-100 */
            border: 2px dashed #3b82f6; /* blue-500 */
            color: #1e40af; /* blue-800 */
            padding: 2px 6px;
            border-radius: 4px;
            display: inline-block;
        }
        .placeholder-b {
            background-color: #ffedd5; /* orange-100 */
            border: 2px dashed #f97316; /* orange-500 */
            color: #9a3412; /* orange-800 */
            padding: 2px 6px;
            border-radius: 4px;
            display: inline-block;
        }

        .highlight-group {
            position: relative;
            z-index: 10;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);
            transform: scale(1.05);
            background-color: white;
        }

        /* 解决 MathJax 闪烁问题 */
        mjx-container {
            display: inline-block !important;
            margin: 0 !important;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans">

<div id="app" class="min-h-screen flex flex-col">

    <!-- 顶部标题区 -->
    <header class="bg-indigo-600 text-white p-4 shadow-md">
        <div class="max-w-5xl mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold">代数公式可视化：整体代换的思想</h1>
                <p class="text-indigo-200 text-sm mt-1">从简单的几何面积到复杂的“火眼金睛”识别</p>
            </div>
            <div class="hidden md:block text-xs bg-indigo-700 p-2 rounded">
                核心概念：占位符 <span class="bg-blue-200 text-blue-800 px-1 rounded">□</span> 与 <span class="bg-orange-200 text-orange-800 px-1 rounded">△</span>
            </div>
        </div>
    </header>

    <main class="flex-grow max-w-5xl mx-auto w-full p-4 flex flex-col md:flex-row gap-6">

        <!-- 左侧控制/导航栏 -->
        <aside class="w-full md:w-64 flex-shrink-0 flex flex-col gap-4">
            <div class="bg-white p-4 rounded-lg shadow border border-gray-200">
                <h3 class="font-bold text-gray-600 mb-3 border-b pb-2">学习阶段</h3>
                <nav class="flex flex-col gap-2">
                    <button @click="currentTab = 'geometric'" 
                        :class="{'bg-indigo-100 text-indigo-700 border-indigo-500': currentTab === 'geometric', 'hover:bg-gray-100': currentTab !== 'geometric'}"
                        class="text-left px-4 py-3 rounded border-l-4 border-transparent transition-all">
                        1. 几何直观 (基础)
                        <div class="text-xs text-gray-400 font-normal mt-1">面积法验证公式</div>
                    </button>
                    <button @click="currentTab = 'substitution'" 
                        :class="{'bg-indigo-100 text-indigo-700 border-indigo-500': currentTab === 'substitution', 'hover:bg-gray-100': currentTab !== 'substitution'}"
                        class="text-left px-4 py-3 rounded border-l-4 border-transparent transition-all">
                        2. 万能占位符 (进阶)
                        <div class="text-xs text-gray-400 font-normal mt-1">把复杂的项看作整体</div>
                    </button>
                    <button @click="currentTab = 'complex'" 
                        :class="{'bg-indigo-100 text-indigo-700 border-indigo-500': currentTab === 'complex', 'hover:bg-gray-100': currentTab !== 'complex'}"
                        class="text-left px-4 py-3 rounded border-l-4 border-transparent transition-all">
                        3. 火眼金睛 (挑战)
                        <div class="text-xs text-gray-400 font-normal mt-1">变形、分组与识别</div>
                    </button>
                </nav>
            </div>

            <!-- 当前公式提示 -->
            <div class="bg-yellow-50 p-4 rounded-lg shadow border border-yellow-200 text-sm">
                <h4 class="font-bold text-yellow-800 mb-2">当前重点公式：</h4>
                <div v-if="currentTab === 'geometric' || currentTab === 'substitution'" class="mb-2">
                    <div class="font-mono text-center">$(a+b)^2 = a^2 + 2ab + b^2$</div>
                    <div class="text-xs text-center text-gray-500 mt-1">完全平方公式</div>
                </div>
                <div v-else-if="currentTab === 'complex'">
                    <!-- 根据选中的例子显示不同公式 -->
                     <div v-if="complexExampleType === 'diff_sq'">
                        <div class="font-mono text-center">$a^2 - b^2 = (a+b)(a-b)$</div>
                        <div class="text-xs text-center text-gray-500 mt-1">平方差公式</div>
                     </div>
                     <div v-else>
                        <div class="font-mono text-center">$(a-b)^2 = a^2 - 2ab + b^2$</div>
                        <div class="text-xs text-center text-gray-500 mt-1">完全平方公式 (差)</div>
                     </div>
                </div>
            </div>
        </aside>

        <!-- 右侧主内容区 -->
        <section class="flex-grow bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden relative min-h-[500px]">
            
            <!-- Tab 1: 几何直观 -->
            <div v-if="currentTab === 'geometric'" class="p-6 h-full flex flex-col">
                <h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">几何意义：为什么会有 $2ab$？</h2>
                
                <div class="flex flex-col md:flex-row h-full gap-8">
                    <!-- 控制区 -->
                    <div class="w-full md:w-1/3 space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-blue-700 mb-1">边长 a 的长度: {{ geoA }}</label>
                            <input type="range" v-model.number="geoA" min="50" max="200" class="w-full accent-blue-600">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-orange-700 mb-1">边长 b 的长度: {{ geoB }}</label>
                            <input type="range" v-model.number="geoB" min="20" max="150" class="w-full accent-orange-500">
                        </div>
                        <div class="text-sm text-gray-600 bg-gray-50 p-3 rounded">
                            <p>总面积 = $(a+b)^2$</p>
                            <p>也就是四个部分之和：</p>
                            <ul class="list-disc pl-5 mt-1 space-y-1">
                                <li>蓝色大正方形 $a^2$</li>
                                <li>两个紫色长方形 $ab$</li>
                                <li>橙色小正方形 $b^2$</li>
                            </ul>
                        </div>
                    </div>

                    <!-- 绘图区 -->
                    <div class="flex-grow flex items-center justify-center bg-gray-50 rounded border relative">
                        <!-- 容器 -->
                        <div class="relative bg-white shadow-lg flex flex-wrap" 
                             :style="{ width: (geoA + geoB) + 'px', height: (geoA + geoB) + 'px' }">
                            
                            <!-- a^2 -->
                            <div class="bg-blue-200 border border-blue-400 flex items-center justify-center text-blue-800 font-bold text-lg absolute top-0 left-0 transition-all duration-300"
                                 :style="{ width: geoA + 'px', height: geoA + 'px' }">
                                $a^2$
                            </div>

                            <!-- ab (右) -->
                            <div class="bg-purple-200 border border-purple-400 flex items-center justify-center text-purple-800 font-bold absolute top-0 transition-all duration-300"
                                 :style="{ left: geoA + 'px', width: geoB + 'px', height: geoA + 'px' }">
                                $ab$
                            </div>

                            <!-- ab (下) -->
                            <div class="bg-purple-200 border border-purple-400 flex items-center justify-center text-purple-800 font-bold absolute left-0 transition-all duration-300"
                                 :style="{ top: geoA + 'px', width: geoA + 'px', height: geoB + 'px' }">
                                $ab$
                            </div>

                            <!-- b^2 -->
                            <div class="bg-orange-200 border border-orange-400 flex items-center justify-center text-orange-800 font-bold absolute transition-all duration-300"
                                 :style="{ top: geoA + 'px', left: geoA + 'px', width: geoB + 'px', height: geoB + 'px' }">
                                $b^2$
                            </div>

                            <!-- 外部标注 -->
                            <div class="absolute -top-6 left-0 text-center text-blue-600 text-sm font-mono" :style="{ width: geoA + 'px' }">a</div>
                            <div class="absolute -top-6 text-center text-orange-600 text-sm font-mono" :style="{ left: geoA + 'px', width: geoB + 'px' }">b</div>
                            <div class="absolute top-0 -left-6 h-full flex flex-col">
                                <div class="flex items-center justify-center text-blue-600 text-sm font-mono" :style="{ height: geoA + 'px' }">a</div>
                                <div class="flex items-center justify-center text-orange-600 text-sm font-mono" :style="{ height: geoB + 'px' }">b</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 2: 万能占位符 -->
            <div v-if="currentTab === 'substitution'" class="p-6 h-full flex flex-col">
                <h2 class="text-xl font-bold text-gray-800 mb-2 border-b pb-2">进阶：万能占位符思想</h2>
                <p class="text-gray-600 mb-6">公式中的 $a$ 和 $b$ 不仅仅是字母，它们是<span class="font-bold text-indigo-600">空盒子</span>。你往盒子里放什么，展开时就带着什么。</p>

                <!-- 交互输入区 -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                        <label class="block text-blue-800 font-bold mb-2">第 1 个盒子 (a) 放什么？</label>
                        <input type="text" v-model="subA" class="w-full p-2 border border-blue-300 rounded focus:ring-2 focus:ring-blue-400 outline-none text-lg font-mono text-blue-700" placeholder="例如: 2x">
                        <div class="mt-2 text-xs text-blue-500">试着输入：x, 2x, 3y, 或 (m+n)</div>
                    </div>
                    <div class="bg-orange-50 p-4 rounded-lg border border-orange-200">
                        <label class="block text-orange-800 font-bold mb-2">第 2 个盒子 (b) 放什么？</label>
                        <input type="text" v-model="subB" class="w-full p-2 border border-orange-300 rounded focus:ring-2 focus:ring-orange-400 outline-none text-lg font-mono text-orange-700" placeholder="例如: 1">
                        <div class="mt-2 text-xs text-orange-500">试着输入：1, 5, 4y, 或 1/2</div>
                    </div>
                </div>

                <!-- 动态演示区 -->
                <div class="flex-grow flex flex-col items-center justify-center space-y-6">
                    <!-- 抽象公式 -->
                    <div class="text-2xl md:text-3xl text-gray-400 font-mono">
                        (<span class="border-2 border-dashed border-blue-300 text-blue-300 px-2 rounded mx-1">□</span> + 
                         <span class="border-2 border-dashed border-orange-300 text-orange-300 px-2 rounded mx-1">△</span>)²
                    </div>
                    
                    <div class="text-2xl text-gray-300">⬇️ 填入内容 ⬇️</div>

                    <!-- 填入后的左边 -->
                    <div class="text-3xl md:text-4xl font-bold font-mono">
                        ( <span class="placeholder-a">{{ subA || '?' }}</span> + <span class="placeholder-b">{{ subB || '?' }}</span> )²
                    </div>

                    <div class="text-2xl text-gray-300">=</div>

                    <!-- 展开结果 -->
                    <div class="text-xl md:text-2xl flex flex-wrap items-center justify-center gap-2 font-mono bg-gray-50 p-6 rounded-xl border border-gray-200 w-full">
                        <!-- a^2 -->
                        <div class="flex flex-col items-center">
                            <span class="placeholder-a mb-1">{{ subA || '?' }}</span>²
                            <span class="text-xs text-gray-400">第一项平方</span>
                        </div>
                        
                        <span class="text-gray-400 font-bold">+</span>
                        
                        <!-- 2ab -->
                        <div class="flex flex-col items-center">
                            <div class="flex items-center bg-purple-50 px-2 py-1 rounded border border-purple-100">
                                2 <span class="text-gray-400 mx-1">·</span> 
                                <span class="text-blue-600 mx-1">({{ subA || '?' }})</span> 
                                <span class="text-gray-400 mx-1">·</span> 
                                <span class="text-orange-600 mx-1">({{ subB || '?' }})</span>
                            </div>
                            <span class="text-xs text-gray-400 mt-1">2 × 第一项 × 第二项</span>
                        </div>

                        <span class="text-gray-400 font-bold">+</span>

                        <!-- b^2 -->
                        <div class="flex flex-col items-center">
                            <span class="placeholder-b mb-1">{{ subB || '?' }}</span>²
                            <span class="text-xs text-gray-400">第二项平方</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 3: 火眼金睛 (复杂案例) -->
            <div v-if="currentTab === 'complex'" class="p-6 h-full flex flex-col">
                <div class="flex justify-between items-center border-b pb-2 mb-4">
                    <h2 class="text-xl font-bold text-gray-800">挑战：谁是 $A$？谁是 $B$？</h2>
                    <!-- 案例切换开关 -->
                    <div class="flex bg-gray-100 rounded-lg p-1 text-sm font-medium">
                        <button @click="setComplexType('diff_sq')" 
                                :class="complexExampleType === 'diff_sq' ? 'bg-white text-indigo-700 shadow' : 'text-gray-500 hover:text-gray-700'"
                                class="px-3 py-1.5 rounded-md transition-all">
                            案例1：平方差
                        </button>
                        <button @click="setComplexType('perf_sq')" 
                                :class="complexExampleType === 'perf_sq' ? 'bg-white text-indigo-700 shadow' : 'text-gray-500 hover:text-gray-700'"
                                class="px-3 py-1.5 rounded-md transition-all">
                            案例2：完全平方
                        </button>
                    </div>
                </div>

                <p class="text-gray-600 mb-4">
                    {{ complexExampleType === 'diff_sq' ? '通过分组找到两个平方数之差。' : '通过提取公因式和分组，构造出完全平方公式的形式。' }}
                </p>

                <!-- 步骤导航 -->
                <div class="flex justify-between items-center mb-8 relative px-4">
                    <div class="absolute top-1/2 left-0 w-full h-1 bg-gray-200 -z-0"></div>
                    <button v-for="(step, index) in currentComplexSteps" :key="index" 
                            @click="setComplexStep(index)"
                            :disabled="index > maxComplexStepReached"
                            class="relative z-10 w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all border-2"
                            :class="complexStepIndex === index ? 'bg-indigo-600 text-white border-indigo-600 scale-110' : (index <= maxComplexStepReached ? 'bg-indigo-100 text-indigo-600 border-indigo-300 hover:bg-indigo-200' : 'bg-gray-100 text-gray-400 border-gray-300')">
                        {{ index + 1 }}
                    </button>
                </div>

                <!-- 步骤内容容器 -->
                <div class="flex-grow flex flex-col items-center justify-center text-center space-y-6">
                    
                    <!-- 步骤说明 -->
                    <div class="bg-indigo-50 text-indigo-800 px-4 py-2 rounded-full text-sm font-bold mb-4">
                        {{ currentComplexSteps[complexStepIndex].title }}
                    </div>

                    <!-- 动态显示的数学式子：案例 1 (平方差) -->
                    <div v-if="complexExampleType === 'diff_sq'" class="text-3xl md:text-5xl font-mono transition-all duration-500 ease-in-out relative p-8">
                        
                        <div v-if="complexStepIndex === 0">
                            $x^2 - 9 + y^2 + 2xy$
                        </div>

                        <div v-if="complexStepIndex === 1" class="flex items-center gap-4 flex-wrap justify-center">
                            <div class="relative p-2 border-2 border-dashed border-blue-400 rounded bg-blue-50">
                                <span class="text-blue-900 font-bold">$x^2 + 2xy + y^2$</span>
                                <div class="absolute -bottom-6 left-0 w-full text-xs text-blue-500">完全平方式</div>
                            </div>
                            <span class="text-gray-400 text-3xl">-</span>
                            <div class="relative p-2 border-2 border-dashed border-orange-400 rounded bg-orange-50">
                                <span class="text-orange-900 font-bold">$9$</span>
                                <div class="absolute -bottom-6 left-0 w-full text-xs text-orange-500">常数项</div>
                            </div>
                        </div>

                        <div v-if="complexStepIndex === 2" class="flex items-center gap-4 flex-wrap justify-center">
                            <div class="relative p-2 border-2 border-blue-500 rounded bg-blue-100 shadow-lg">
                                <span class="text-blue-900 font-bold">$(x+y)^2$</span>
                                <div class="absolute -top-8 left-0 w-full text-sm font-bold text-blue-600">这是整体 A</div>
                            </div>
                            <span class="text-gray-600 font-bold text-3xl">-</span>
                            <div class="relative p-2 border-2 border-orange-500 rounded bg-orange-100 shadow-lg">
                                <span class="text-orange-900 font-bold">$3^2$</span>
                                <div class="absolute -top-8 left-0 w-full text-sm font-bold text-orange-600">这是整体 B</div>
                            </div>
                        </div>

                        <div v-if="complexStepIndex === 3" class="text-left">
                            <div class="text-xl text-gray-500 mb-4 text-center">使用平方差公式：$A^2 - B^2 = (A+B)(A-B)$</div>
                            <div class="text-3xl font-bold flex items-center justify-center gap-2 flex-wrap">
                                <span class="text-gray-600">(</span>
                                <span class="placeholder-a">x+y</span>
                                <span class="text-gray-800 font-bold">+</span>
                                <span class="placeholder-b">3</span>
                                <span class="text-gray-600">)</span>
                                <span class="text-gray-600">(</span>
                                <span class="placeholder-a">x+y</span>
                                <span class="text-gray-800 font-bold">-</span>
                                <span class="placeholder-b">3</span>
                                <span class="text-gray-600">)</span>
                            </div>
                        </div>
                    </div>

                    <!-- 动态显示的数学式子：案例 2 (完全平方) -->
                    <div v-if="complexExampleType === 'perf_sq'" class="text-2xl md:text-4xl font-mono transition-all duration-500 ease-in-out relative p-8">
                        
                        <!-- 步骤 1: 原始乱序 -->
                        <div v-if="complexStepIndex === 0">
                            $x^2 + 2xy + y^2 - 10x - 10y + 25$
                        </div>

                        <!-- 步骤 2: 分组与提公因式 -->
                        <div v-if="complexStepIndex === 1" class="flex items-center gap-2 flex-wrap justify-center">
                            <div class="relative p-2 border-2 border-dashed border-blue-400 rounded bg-blue-50">
                                <span class="text-blue-900 font-bold">$x^2 + 2xy + y^2$</span>
                                <div class="absolute -bottom-6 left-0 w-full text-xs text-blue-500">组1: 完全平方式</div>
                            </div>
                            
                            <div class="relative p-2 border-2 border-dashed border-purple-400 rounded bg-purple-50 mx-2">
                                <span class="text-purple-900 font-bold">$-10(x + y)$</span>
                                <div class="absolute -bottom-6 left-0 w-full text-xs text-purple-500">组2: 提公因式</div>
                            </div>

                            <div class="relative p-2 border-2 border-dashed border-orange-400 rounded bg-orange-50">
                                <span class="text-orange-900 font-bold">$+ 25$</span>
                                <div class="absolute -bottom-6 left-0 w-full text-xs text-orange-500">组3: 常数</div>
                            </div>
                        </div>

                        <!-- 步骤 3: 识别整体结构 -->
                        <div v-if="complexStepIndex === 2" class="flex flex-col gap-4 items-center">
                             <div class="flex items-center gap-2 flex-wrap justify-center">
                                <div class="relative p-2 border-2 border-blue-500 rounded bg-blue-100 shadow-lg">
                                    <span class="text-blue-900 font-bold">$(x+y)^2$</span>
                                    <div class="absolute -top-8 left-0 w-full text-sm font-bold text-blue-600">A²</div>
                                </div>
                                <span class="text-gray-600 font-bold">-</span>
                                <div class="relative p-2 border-2 border-purple-500 rounded bg-purple-100 shadow-lg mx-1">
                                    <span class="text-purple-900 font-bold">$2 \cdot 5 \cdot (x+y)$</span>
                                    <div class="absolute -top-8 left-0 w-full text-sm font-bold text-purple-600">2AB</div>
                                </div>
                                <span class="text-gray-600 font-bold">+</span>
                                <div class="relative p-2 border-2 border-orange-500 rounded bg-orange-100 shadow-lg">
                                    <span class="text-orange-900 font-bold">$5^2$</span>
                                    <div class="absolute -top-8 left-0 w-full text-sm font-bold text-orange-600">B²</div>
                                </div>
                            </div>
                            <div class="text-sm text-gray-500 mt-2">
                                此时 $A = (x+y)$，$B = 5$
                            </div>
                        </div>

                        <!-- 步骤 4: 套用公式 -->
                        <div v-if="complexStepIndex === 3" class="text-left">
                            <div class="text-xl text-gray-500 mb-4 text-center">使用完全平方公式 (差)：$(A-B)^2$</div>
                            <div class="text-3xl font-bold flex items-center justify-center gap-1">
                                <span class="text-gray-600">(</span>
                                <div class="flex flex-col items-center">
                                    <span class="placeholder-a px-2">x+y</span>
                                    <span class="text-xs text-blue-500 mt-1">A</span>
                                </div>
                                <span class="text-gray-800 font-bold mx-2">-</span>
                                <div class="flex flex-col items-center">
                                    <span class="placeholder-b px-2">5</span>
                                    <span class="text-xs text-orange-500 mt-1">B</span>
                                </div>
                                <span class="text-gray-600">)²</span>
                            </div>
                             <div class="text-center mt-6 text-2xl text-gray-800">
                                $= (x + y - 5)^2$
                            </div>
                        </div>
                    </div>

                    <!-- 步骤控制按钮 -->
                    <div class="mt-8">
                        <button v-if="complexStepIndex < 3" @click="nextComplexStep" class="bg-indigo-600 hover:bg-indigo-700 text-white px-8 py-3 rounded-lg shadow font-bold flex items-center gap-2 transition-colors">
                            下一步
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                        </button>
                        <button v-else @click="complexStepIndex = 0" class="bg-gray-600 hover:bg-gray-700 text-white px-8 py-3 rounded-lg shadow font-bold transition-colors">
                            再看一遍
                        </button>
                    </div>

                    <div class="text-gray-500 text-sm max-w-lg mt-4 bg-white p-3 border rounded">
                        解说：{{ currentComplexSteps[complexStepIndex].desc }}
                    </div>

                </div>
            </div>

        </section>

    </main>

    <footer class="bg-gray-100 border-t p-4 text-center text-gray-500 text-sm mt-4">
        互动数学演示 | 核心思想：结构识别与整体代换
    </footer>

</div>

<script>
    const { createApp, ref, computed, watch, nextTick } = Vue;

    createApp({
        setup() {
            const currentTab = ref('geometric'); // geometric, substitution, complex
            
            // 几何部分的变量
            const geoA = ref(120);
            const geoB = ref(60);

            // 代换部分的变量
            const subA = ref('2x');
            const subB = ref('3y');

            // 复杂案例部分
            const complexExampleType = ref('diff_sq'); // 'diff_sq' (平方差) or 'perf_sq' (完全平方)
            const complexStepIndex = ref(0);
            const maxComplexStepReached = ref(0);

            const stepsDiffSq = [
                { title: '1. 观察原式', desc: '这是一个看起来很乱的四项式，既有 x 又有 y，还有常数。单纯看很难直接套公式。' },
                { title: '2. 分组归类', desc: '我们发现前三项 x, xy, y 正好能凑成一组（完全平方式），剩下的 9 是个常数。我们给它们分别“画个圈”。' },
                { title: '3. 识别整体 (占位符)', desc: '把第一组折叠成 (x+y)²，把 9 写成 3²。现在形式变成了 A² - B²。这里的 A 就是 (x+y)，B 就是 3。' },
                { title: '4. 套用公式', desc: '既然认出了 A 和 B，直接把它们填进平方差公式 (A+B)(A-B) 的坑位里，任务完成！' }
            ];

            const stepsPerfSq = [
                { title: '1. 观察原式', desc: '这个式子更长了，有6项（其实可以看作5部分）。$x^2 + 2xy + y^2 - 10x - 10y + 25$。' },
                { title: '2. 提公因式与分组', desc: '前三项 $x^2+2xy+y^2$ 很像完全平方。中间的 $-10x-10y$ 都有 -10，可以提取出来。' },
                { title: '3. 识别整体结构', desc: '变形后得到 $(x+y)^2 - 10(x+y) + 25$。这其实就是 $A^2 - 2 \cdot 5 \cdot A + 5^2$ 的结构。' },
                { title: '4. 套用公式', desc: '这是完全平方公式 $(A-B)^2$。其中 A 是 $(x+y)$，B 是 $5$。' }
            ];

            const currentComplexSteps = computed(() => {
                return complexExampleType.value === 'diff_sq' ? stepsDiffSq : stepsPerfSq;
            });

            const setComplexType = (type) => {
                complexExampleType.value = type;
                complexStepIndex.value = 0;
                maxComplexStepReached.value = 0;
                refreshMathJax();
            };

            const nextComplexStep = () => {
                if (complexStepIndex.value < currentComplexSteps.value.length - 1) {
                    complexStepIndex.value++;
                    if (complexStepIndex.value > maxComplexStepReached.value) {
                        maxComplexStepReached.value = complexStepIndex.value;
                    }
                }
                refreshMathJax();
            };

            const setComplexStep = (index) => {
                complexStepIndex.value = index;
                refreshMathJax();
            };

            // 监听 Tab 切换和步骤变化，手动触发 MathJax 渲染
            const refreshMathJax = () => {
                nextTick(() => {
                    if (window.MathJax && window.MathJax.typesetPromise) {
                        window.MathJax.typesetPromise();
                    }
                });
            };

            watch(currentTab, refreshMathJax);
            watch(complexStepIndex, refreshMathJax);

            // 初始化渲染
            refreshMathJax();

            return {
                currentTab,
                geoA, geoB,
                subA, subB,
                complexExampleType,
                complexStepIndex,
                currentComplexSteps,
                nextComplexStep,
                setComplexStep,
                setComplexType,
                maxComplexStepReached
            };
        }
    }).mount('#app');
</script>

</body>
</html>