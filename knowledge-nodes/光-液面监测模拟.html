<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‰©ç†ç¬¬12é¢˜ï¼šæ¶²é¢å‡é™ç›‘æµ‹è£…ç½®åŸç†æ¨¡æ‹Ÿ</title>
    <!-- å¼•å…¥ Tailwind CSS è¿›è¡Œå¿«é€Ÿæ ·å¼è®¾è®¡ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥æ•°å­¦å…¬å¼å­—ä½“ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0fdf4; /* æµ…ç»¿è‰²èƒŒæ™¯ï¼ŒæŠ¤çœ¼ */
        }
        canvas {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            cursor: crosshair;
        }
        .highlight {
            color: #d97706; /* amber-600 */
            font-weight: bold;
        }
        .panel-glass {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="flex flex-col items-center min-h-screen p-4">

    <!-- æ ‡é¢˜åŒºåŸŸ -->
    <header class="w-full max-w-4xl mb-6 text-center">
        <h1 class="text-3xl font-bold text-slate-800 mb-2">ğŸ”­ ç‰©ç†ç¬¬12é¢˜ï¼šæ¶²é¢å‡é™ç›‘æµ‹æ¼”ç¤º</h1>
        <p class="text-slate-600">æ‹–åŠ¨ä¸‹æ–¹æ»‘å—æ”¹å˜æ¶²é¢é«˜åº¦ï¼Œè§‚å¯Ÿå…‰æ–‘ä½ç½®çš„å˜åŒ–</p>
    </header>

    <!-- ä¸»å®¹å™¨ -->
    <main class="w-full max-w-5xl flex flex-col md:flex-row gap-6">
        
        <!-- å·¦ä¾§ï¼šæ§åˆ¶ä¸æ•°æ®é¢æ¿ -->
        <div class="w-full md:w-1/3 flex flex-col gap-4">
            
            <!-- æ§åˆ¶å¡ç‰‡ -->
            <div class="panel-glass rounded-xl p-6 shadow-lg border border-green-100">
                <label for="heightRange" class="block text-sm font-medium text-slate-700 mb-2">
                    ğŸŒŠ æ¶²é¢é«˜åº¦è°ƒèŠ‚
                </label>
                <input type="range" id="heightRange" min="0" max="100" value="30" class="w-full h-2 bg-blue-200 rounded-lg appearance-none cursor-pointer accent-blue-600">
                <div class="flex justify-between text-xs text-slate-500 mt-1">
                    <span>ä½</span>
                    <span>é«˜</span>
                </div>
            </div>

            <!-- æ•°æ®æ˜¾ç¤ºå¡ç‰‡ -->
            <div class="panel-glass rounded-xl p-6 shadow-lg border border-slate-100">
                <h3 class="font-bold text-slate-800 border-b pb-2 mb-3">å®æ—¶æ•°æ®ç›‘æµ‹</h3>
                <ul class="space-y-3 text-sm">
                    <li class="flex justify-between">
                        <span class="text-slate-600">å…¥å°„å…‰çº¿ä¸æ¶²é¢å¤¹è§’ï¼š</span>
                        <span class="font-mono font-bold text-blue-600">40Â°</span>
                    </li>
                    <li class="flex justify-between">
                        <span class="text-slate-600">å…¥å°„è§’ (ä¸æ³•çº¿å¤¹è§’)ï¼š</span>
                        <span class="font-mono font-bold text-red-600">50Â°</span>
                    </li>
                    <li class="flex justify-between">
                        <span class="text-slate-600">åå°„è§’ï¼š</span>
                        <span class="font-mono font-bold text-red-600">50Â°</span>
                    </li>
                    <li class="flex justify-between items-center bg-yellow-50 p-2 rounded">
                        <span class="text-slate-700">å…‰æ–‘ S' ç§»åŠ¨æ–¹å‘ï¼š</span>
                        <span id="directionText" class="font-bold text-yellow-700">--</span>
                    </li>
                </ul>
            </div>

            <!-- è€å¸ˆçš„è®²è§£ -->
            <div class="panel-glass rounded-xl p-6 shadow-lg border-l-4 border-green-500 bg-green-50">
                <h3 class="font-bold text-green-800 mb-2">ğŸ‘¨â€ğŸ« è€å¸ˆç”»é‡ç‚¹</h3>
                <p class="text-sm text-slate-700 leading-relaxed">
                    æ³¨æ„è§‚å¯Ÿï¼å½“æ¶²é¢<span class="font-bold text-blue-600">ä¸Šå‡</span>æ—¶ï¼Œå…¥å°„å…‰çº¿ç…§å°„åˆ°æ¶²é¢çš„ç‚¹ä¼šå‘<span class="font-bold">å·¦</span>ç§»åŠ¨ã€‚
                    <br><br>
                    è™½ç„¶<span class="highlight">å…¥å°„è§’å§‹ç»ˆä¿æŒ 50Â° ä¸å˜</span>ï¼Œä½†å› ä¸ºåå°„ç‚¹å·¦ç§»äº†ï¼Œæ•´ä¸ªåå°„å…‰è·¯éƒ½ä¼šå¹³ç§»ï¼Œå¯¼è‡´æ ‡å°ºä¸Šçš„å…‰æ–‘ S' ä¹Ÿå‘<span class="font-bold text-red-500">å·¦</span>ç§»åŠ¨ã€‚
                </p>
            </div>
        </div>

        <!-- å³ä¾§ï¼šCanvas åŠ¨ç”»åŒºåŸŸ -->
        <div class="w-full md:w-2/3 relative">
            <div class="relative w-full aspect-[4/3] bg-white rounded-xl shadow-2xl overflow-hidden border border-slate-200">
                <canvas id="simCanvas" class="w-full h-full block"></canvas>
                
                <!-- æ ‡å°ºçš„HTMLè¦†ç›–å±‚ï¼ˆä¸ºäº†æ›´æ¸…æ™°çš„æ–‡å­—ï¼‰ -->
                <div class="absolute top-0 right-0 w-full h-12 bg-gradient-to-b from-gray-100 to-transparent pointer-events-none flex justify-end px-10 pt-1">
                    <div class="text-xs text-gray-400 font-mono tracking-[1em]">|||||||||||||||||||||||||</div>
                </div>
            </div>
             <p class="text-center text-xs text-slate-400 mt-2">å›¾ç¤ºéä¸¥æ ¼æ¯”ä¾‹ï¼Œæ—¨åœ¨æ¼”ç¤ºå…‰è·¯åŸç†</p>
        </div>
    </main>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        const rangeInput = document.getElementById('heightRange');
        const directionText = document.getElementById('directionText');

        // è®¾ç½® Canvas åˆ†è¾¨ç‡ (HiDPI æ”¯æŒ)
        let width, height;
        const dpr = window.devicePixelRatio || 1;

        function resize() {
            const rect = canvas.getBoundingClientRect();
            width = rect.width;
            height = rect.height;
            canvas.width = width * dpr;
            canvas.height = height * dpr;
            ctx.scale(dpr, dpr);
            draw();
        }
        window.addEventListener('resize', resize);

        // ç‰©ç†å‚æ•°çŠ¶æ€
        let state = {
            waterLevelPercent: 30, // 0 - 100
            angleWithSurface: 40, // é¢˜ç›®ç»™å®šçš„40åº¦
            prevSpotX: null
        };

        // ç»˜å›¾è¾…åŠ©å‡½æ•°ï¼šç”»ç®­å¤´
        function drawArrow(fromX, fromY, toX, toY, color) {
            const headlen = 10; 
            const dx = toX - fromX;
            const dy = toY - fromY;
            const angle = Math.atan2(dy, dx);
            
            ctx.beginPath();
            ctx.moveTo(fromX, fromY);
            ctx.lineTo(toX, toY);
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.stroke();

            // ç®­å¤´å¤´éƒ¨ (ç”»åœ¨ä¸­é—´ä½ç½®ï¼Œè¡¨ç¤ºå…‰çº¿èµ°å‘)
            const midX = (fromX + toX) / 2;
            const midY = (fromY + toY) / 2;
            
            ctx.beginPath();
            ctx.moveTo(midX, midY);
            ctx.lineTo(midX - headlen * Math.cos(angle - Math.PI / 6), midY - headlen * Math.sin(angle - Math.PI / 6));
            ctx.moveTo(midX, midY);
            ctx.lineTo(midX - headlen * Math.cos(angle + Math.PI / 6), midY - headlen * Math.sin(angle + Math.PI / 6));
            ctx.stroke();
        }

        // æ ¸å¿ƒç»˜å›¾é€»è¾‘
        function draw() {
            ctx.clearRect(0, 0, width, height);

            // 1. å®šä¹‰åæ ‡å’Œå‚æ•°
            const rulerY = 50; // æ ‡å°ºåœ¨é¡¶éƒ¨çš„ Y åæ ‡
            const sourceX = 100; // å…‰æº S çš„ X
            const sourceY = 100; // å…‰æº S çš„ Y
            
            // è®¡ç®—æ°´çš„å®é™…åƒç´ é«˜åº¦
            // åº•éƒ¨ç•™ç©ºï¼Œæ¨¡æ‹Ÿå®¹å™¨åº•éƒ¨
            const maxWaterY = height - 50; 
            const minWaterY = height - 250; 
            // æ³¨æ„ï¼šCanvas Yè½´å‘ä¸‹ï¼Œæ‰€ä»¥æ•°å€¼è¶Šå°ï¼Œæ°´ä½è¶Šé«˜
            const currentWaterY = maxWaterY - ((maxWaterY - minWaterY) * (state.waterLevelPercent / 100));

            // 2. ç»˜åˆ¶ç¯å¢ƒ
            
            // ç»˜åˆ¶æ ‡å°º (é¡¶éƒ¨çš„çŸ©å½¢)
            ctx.fillStyle = '#e2e8f0';
            ctx.fillRect(50, rulerY - 20, width - 100, 30);
            ctx.strokeStyle = '#94a3b8';
            ctx.beginPath();
            ctx.moveTo(50, rulerY + 10);
            ctx.lineTo(width - 50, rulerY + 10);
            ctx.stroke();
            // åˆ»åº¦çº¿
            for(let i = 100; i < width - 100; i+=20) {
                ctx.beginPath();
                ctx.moveTo(i, rulerY - 10);
                ctx.lineTo(i, rulerY + 10);
                ctx.stroke();
            }
            ctx.fillStyle = '#64748b';
            ctx.font = '12px Arial';
            ctx.fillText("æ ‡å°º", width - 80, rulerY - 25);

            // ç»˜åˆ¶æ°´ä½“
            ctx.fillStyle = 'rgba(59, 130, 246, 0.2)'; // æµ…è“
            ctx.fillRect(50, currentWaterY, width - 100, height - currentWaterY);
            // æ°´é¢çº¿
            ctx.strokeStyle = '#2563eb';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(50, currentWaterY);
            ctx.lineTo(width - 50, currentWaterY);
            ctx.stroke();
            ctx.fillStyle = '#1e40af';
            ctx.fillText("æ¶²é¢", width - 90, currentWaterY - 10);

            // 3. è®¡ç®—å…‰è·¯å‡ ä½•
            // é¢˜ç›®ï¼šå…‰çº¿ä¸æ°´é¢å¤¹è§’ 40åº¦ã€‚
            // å…¥å°„è§’ = 90 - 40 = 50åº¦ã€‚
            const angleRad = (state.angleWithSurface * Math.PI) / 180;
            
            // è®¡ç®—å…¥å°„ç‚¹ P (å…‰çº¿ç¢°åˆ°æ°´é¢çš„ä½ç½®)
            // tan(angle) = dy / dx  => dx = dy / tan(angle)
            const dy_incident = currentWaterY - sourceY;
            const dx_incident = dy_incident / Math.tan(angleRad);
            const pX = sourceX + dx_incident;
            const pY = currentWaterY;

            // è®¡ç®—æ ‡å°ºä¸Šçš„å…‰æ–‘ S'
            // åå°„æ˜¯å¯¹ç§°çš„ï¼Œä» P ç‚¹å‘ä¸Šå›åˆ°æ ‡å°ºé«˜åº¦
            const dy_reflect = currentWaterY - rulerY - 10; // åå°„åˆ°æ ‡å°ºä¸‹æ²¿
            // æ°´å¹³è·ç¦»å’Œå…¥å°„æ—¶ä¸€æ ·ï¼ˆå› ä¸ºè§’åº¦ç›¸åŒï¼‰
            const dx_reflect = dy_reflect / Math.tan(angleRad);
            const spotX = pX + dx_reflect;
            const spotY = rulerY + 10;

            // 4. ç»˜åˆ¶å…‰è·¯

            // ç»˜åˆ¶å…‰æº S
            ctx.beginPath();
            ctx.arc(sourceX, sourceY, 6, 0, 2 * Math.PI);
            ctx.fillStyle = '#f59e0b';
            ctx.fill();
            ctx.fillStyle = '#000';
            ctx.font = 'bold 16px Arial';
            ctx.fillText("S", sourceX - 20, sourceY + 5);

            // ç»˜åˆ¶å…¥å°„å…‰çº¿
            drawArrow(sourceX, sourceY, pX, pY, '#ef4444'); // çº¢è‰²

            // ç»˜åˆ¶æ³•çº¿ (è™šçº¿)
            ctx.setLineDash([5, 5]);
            ctx.strokeStyle = '#9ca3af';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(pX, pY - 100);
            ctx.lineTo(pX, pY + 50);
            ctx.stroke();
            ctx.setLineDash([]); // é‡ç½®è™šçº¿

            // ç»˜åˆ¶åå°„å…‰çº¿
            drawArrow(pX, pY, spotX, spotY, '#ef4444');

            // ç»˜åˆ¶åå°„å…‰æ–‘ S'
            ctx.beginPath();
            ctx.arc(spotX, spotY, 8, 0, 2 * Math.PI);
            ctx.fillStyle = '#ef4444'; // çº¢ç‚¹
            ctx.shadowBlur = 10;
            ctx.shadowColor = "red";
            ctx.fill();
            ctx.shadowBlur = 0;
            ctx.fillStyle = '#000';
            ctx.fillText("S'", spotX - 5, spotY - 15);

            // 5. æ ‡æ³¨è§’åº¦
            // æ ‡æ³¨ä¸æ¶²é¢çš„å¤¹è§’ (40åº¦)
            ctx.strokeStyle = '#059669';
            ctx.beginPath();
            ctx.arc(pX, pY, 40, Math.PI, Math.PI + angleRad, false); // æ³¨æ„ Canvas è§’åº¦æ–¹å‘
            // è¿™é‡Œä¸ºäº†ç®€åŒ–ç”»å›¾é€»è¾‘ï¼Œç®€å•ç”»ä¸€æ¡å¼§çº¿ç¤ºæ„
            ctx.stroke();
            ctx.fillStyle = '#059669';
            ctx.font = '12px Arial';
            ctx.fillText("40Â°", pX - 60, pY - 10);

            // æ ‡æ³¨åå°„è§’ (50åº¦)
            ctx.strokeStyle = '#7c3aed';
            ctx.beginPath();
            // æ³•çº¿æ˜¯ -90åº¦ (å‘ä¸Š)ã€‚åå°„å…‰çº¿è§’åº¦è®¡ç®—æœ‰ç‚¹å¤æ‚ï¼Œæˆ‘ä»¬ç®€åŒ–æ ‡æ³¨ä½ç½®
            ctx.fillText("åå°„è§’ 50Â°", pX + 10, pY - 60);


            // 6. é€»è¾‘åˆ¤æ–­ä¸æ–‡æœ¬æ›´æ–°
            // æ›´æ–°æ–¹å‘æ–‡æœ¬
            if (state.prevSpotX !== null) {
                if (Math.abs(spotX - state.prevSpotX) < 0.1) {
                    directionText.innerText = "é™æ­¢";
                    directionText.className = "font-bold text-slate-500";
                } else if (spotX < state.prevSpotX) {
                    directionText.innerText = "â† å‘å·¦ç§»åŠ¨";
                    directionText.className = "font-bold text-red-600 animate-pulse";
                } else {
                    directionText.innerText = "å‘å³ç§»åŠ¨ â†’";
                    directionText.className = "font-bold text-blue-600";
                }
            }
            state.prevSpotX = spotX;
        }

        // åˆå§‹åŒ–
        setTimeout(resize, 100);

        // äº‹ä»¶ç›‘å¬
        rangeInput.addEventListener('input', (e) => {
            state.waterLevelPercent = parseInt(e.target.value);
            window.requestAnimationFrame(draw);
        });

    </script>
</body>
</html>